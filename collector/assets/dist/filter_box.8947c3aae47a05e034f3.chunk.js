(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1023:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));t.default=r.default.shape({aggregate_name:r.default.string.isRequired})},1024:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=d;var r=c(n(1)),a=c(n(0)),o=c(n(294)),l=c(n(293)),i=c(n(1781)),u=c(n(229)),s=c(n(291));function c(e){return e&&e.__esModule?e:{default:e}}var f={option:a.default.oneOfType([u.default,a.default.shape({saved_metric_name:a.default.string.isRequired}),s.default]).isRequired};function d(e){var t=e.option;return t.saved_metric_name?r.default.createElement("div",null,r.default.createElement(l.default,{type:"expression"}),r.default.createElement("span",{className:"m-r-5 option-label"},t.saved_metric_name)):t.column_name?r.default.createElement(o.default,{column:t,showType:!0}):t.label?r.default.createElement(i.default,{adhocMetric:t,showType:!0}):void 0}d.propTypes=f},1182:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(r=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=p(n(1)),l=p(n(0)),i=n(12);n(888);var u=p(n(1728));n(1761);var s=p(n(8)),c=p(n(65)),f=n(11),d=p(n(551));function p(e){return e&&e.__esModule?e:{default:e}}var h=Object.freeze({DEFAULTS:"defaults",CUSTOM_START_END:"custom_start_end",CUSTOM_RANGE:"custom_range"}),m=Object.freeze({LAST:"Last",NEXT:"Next"}),y=["Last day","Last week","Last month","Last quarter","Last year","No filter"],v=["seconds","minutes","hours","days","weeks","months","years"],g="YYYY-MM-DD[T]HH:mm:ss",b=(0,s.default)().startOf("day").subtract(7,"days").format(g),E=(0,s.default)().startOf("day").format(g),C="Invalid date",O=" : ",_=(0,f.t)("Superset supports smart date parsing. Strings like `last sunday` or `last october` can be used."),S={animation:l.default.bool,name:l.default.string.isRequired,label:l.default.string,description:l.default.string,onChange:l.default.func,value:l.default.string,height:l.default.number},T={animation:!0,onChange:function(){return function(){}}(),value:"Last week"};function w(e){return e!==(0,s.default)(e,g).format(g)}var j=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=e.value||T.value;if(n.state={type:h.DEFAULTS,common:y[0],rel:m.LAST,num:"7",grain:v[3],since:b,until:E,freeformInputs:{}},a.indexOf(O)>=0){n.state.type=h.CUSTOM_START_END;var o=a.split(O,2),l=r(o,2);n.state.since=l[0],n.state.until=l[1]}else if(n.state.type=h.DEFAULTS,y.indexOf(a)>=0)n.state.common=a;else{n.state.common=null;var i=a.split(" ",3),u=r(i,3);n.state.rel=u[0],n.state.num=u[1],n.state.grain=u[2]}return n.state.freeformInputs.since=w(n.state.since),n.state.freeformInputs.until=w(n.state.until),n.dateTimeFieldRefs={},n.handleClick=n.handleClick.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"componentDidMount",value:function(){return function(){document.addEventListener("click",this.handleClick)}}()},{key:"componentWillUnmount",value:function(){return function(){document.removeEventListener("click",this.handleClick)}}()},{key:"onEnter",value:function(){return function(e){"Enter"===e.key&&this.close()}}()},{key:"setDefaults",value:function(){return function(e){var t={type:h.DEFAULTS,common:e,until:(0,s.default)().startOf("day").format(g)},n=e.split(" ")[1]+"s";t.since=(0,s.default)().startOf("day").subtract(1,n).format(g),this.setState(t,this.updateRefs)}}()},{key:"setCustomRange",value:function(){return function(e,t){var n=Object.assign({},this.state,{type:h.CUSTOM_RANGE});void 0!==e&&void 0!==t&&(n[e]=t),n.rel===m.LAST?(n.until=(0,s.default)().startOf("day").format(g),n.since=(0,s.default)().startOf("day").subtract(n.num,n.grain).format(g)):(n.until=(0,s.default)().startOf("day").add(n.num,n.grain).format(g),n.since=(0,s.default)().startOf("day").format(g)),this.setState(n,this.updateRefs)}}()},{key:"setCustomStartEnd",value:function(){return function(e,t){var n={type:h.CUSTOM_START_END,freeformInputs:Object.assign({},this.state.freeformInputs)};if(t===C){var r=this.dateTimeFieldRefs[e].state.inputValue;n.freeformInputs[e]=!0,n[e]=r}else n.freeformInputs[e]=!1,n[e]=t;this.setState(n,this.updateRefs)}}()},{key:"handleClick",value:function(){return function(e){this.startEndSectionRef&&this.startEndSectionRef.contains(e.target)&&this.setState({type:h.CUSTOM_START_END})}}()},{key:"updateRefs",value:function(){return function(){this.dateTimeFieldRefs.since.setState({inputValue:this.state.since}),this.dateTimeFieldRefs.until.setState({inputValue:this.state.until})}}()},{key:"close",value:function(){return function(){var e=void 0;e=this.state.type===h.DEFAULTS?this.state.common:this.state.type===h.CUSTOM_RANGE?this.state.rel+" "+this.state.num+" "+this.state.grain:[this.state.since,this.state.until].join(O),this.props.onChange(e),this.refs.trigger.hide()}}()},{key:"renderPopover",value:function(){return function(){var e=this,t=v.map(function(t){return o.default.createElement(i.MenuItem,{onSelect:e.setCustomRange.bind(e,"grain"),key:t,eventKey:t,active:t===e.state.grain},t)}),n=y.map(function(t){return o.default.createElement(i.Radio,{key:t.replace(" ","").toLowerCase(),checked:e.state.common===t,onChange:e.setDefaults.bind(e,t)},t)});return o.default.createElement(i.Popover,{id:"filter-popover",placement:"top",positionTop:0},o.default.createElement("div",{style:{width:"250px"}},o.default.createElement(i.Tabs,{defaultActiveKey:this.state.type===h.DEFAULTS?1:2,id:"type",className:"time-filter-tabs"},o.default.createElement(i.Tab,{eventKey:1,title:"Defaults"},o.default.createElement(i.FormGroup,null,n)),o.default.createElement(i.Tab,{eventKey:2,title:"Custom"},o.default.createElement(i.FormGroup,null,o.default.createElement(d.default,{title:"Relative to today",isSelected:this.state.type===h.CUSTOM_RANGE,onSelect:this.setCustomRange.bind(this)},o.default.createElement("div",{className:"clearfix centered",style:{marginTop:"12px"}},o.default.createElement("div",{style:{width:"60px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.DropdownButton,{bsSize:"small",componentClass:i.InputGroup.Button,id:"input-dropdown-rel",title:this.state.rel,onFocus:this.setCustomRange.bind(this)},o.default.createElement(i.MenuItem,{onSelect:this.setCustomRange.bind(this,"rel"),key:m.LAST,eventKey:m.LAST,active:this.state.rel===m.LAST},"Last"),o.default.createElement(i.MenuItem,{onSelect:this.setCustomRange.bind(this,"rel"),key:m.NEXT,eventKey:m.NEXT,active:this.state.rel===m.NEXT},"Next"))),o.default.createElement("div",{style:{width:"60px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.FormControl,{bsSize:"small",type:"text",onChange:function(t){return e.setCustomRange.call(e,"num",t.target.value)},onFocus:this.setCustomRange.bind(this),onKeyPress:this.onEnter.bind(this),value:this.state.num,style:{height:"30px"}})),o.default.createElement("div",{style:{width:"90px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.DropdownButton,{bsSize:"small",componentClass:i.InputGroup.Button,id:"input-dropdown-grain",title:this.state.grain,onFocus:this.setCustomRange.bind(this)},t)))),o.default.createElement(d.default,{title:"Start / end",isSelected:this.state.type===h.CUSTOM_START_END,onSelect:this.setCustomStartEnd.bind(this),info:_},o.default.createElement("div",{ref:function(t){e.startEndSectionRef=t}},o.default.createElement(i.InputGroup,null,o.default.createElement("div",{style:{margin:"5px 0"}},o.default.createElement(u.default,{ref:function(t){e.dateTimeFieldRefs.since=t},dateTime:this.state.freeformInputs.since?b:this.state.since,defaultText:this.state.since,onChange:this.setCustomStartEnd.bind(this,"since"),maxDate:(0,s.default)(this.state.until,g),format:g,inputFormat:g,onClick:this.setCustomStartEnd.bind(this),inputProps:{onKeyPress:this.onEnter.bind(this),onFocus:this.setCustomStartEnd.bind(this)}})),o.default.createElement("div",{style:{margin:"5px 0"}},o.default.createElement(u.default,{ref:function(t){e.dateTimeFieldRefs.until=t},dateTime:this.state.freeformInputs.until?E:this.state.until,defaultText:this.state.until,onChange:this.setCustomStartEnd.bind(this,"until"),minDate:(0,s.default)(this.state.since,g).add(1,"days"),format:g,inputFormat:g,inputProps:{onKeyPress:this.onEnter.bind(this),onFocus:this.setCustomStartEnd.bind(this)}})))))))),o.default.createElement("div",{className:"clearfix"},o.default.createElement(i.Button,{bsSize:"small",className:"float-right ok",bsStyle:"primary",onClick:this.close.bind(this)},"Ok"))))}}()},{key:"render",value:function(){return function(){var e=this.props.value||T.value;return e=e.split(O).map(function(e){return e.replace("T00:00:00","")||"∞"}).join(O),o.default.createElement("div",null,o.default.createElement(c.default,this.props),o.default.createElement(i.OverlayTrigger,{animation:this.props.animation,container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},o.default.createElement(i.Label,{style:{cursor:"pointer"}},e)))}}()}]),t}();t.default=j,j.propTypes=S,j.defaultProps=T},1192:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(1)),a=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var l=12,i={controls:a.default.arrayOf(a.default.object).isRequired};function u(e){var t=l/e.controls.length;return r.default.createElement("div",{className:"row space-1"},e.controls.map(function(e,n){return r.default.createElement("div",{className:"col-lg-"+t+" col-xs-12",key:n},e)}))}u.propTypes=i,t.default=u},1193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(n(1)),l=u(n(0)),i=u(n(802));function u(e){return e&&e.__esModule?e:{default:e}}var s=Object.keys(i.default),c={actions:l.default.object.isRequired,name:l.default.string.isRequired,type:l.default.oneOf(s).isRequired,hidden:l.default.bool,label:l.default.string.isRequired,choices:l.default.arrayOf(l.default.array),description:l.default.string,tooltipOnClick:l.default.func,places:l.default.number,validators:l.default.array,validationErrors:l.default.array,renderTrigger:l.default.bool,rightNode:l.default.node,formData:l.default.object,value:l.default.oneOfType([l.default.string,l.default.number,l.default.object,l.default.bool,l.default.array,l.default.func])},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={hovered:!1},n.validate=n.validate.bind(n),n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),a(t,[{key:"componentDidMount",value:function(){return function(){this.validateAndSetValue(this.props.value,[])}}()},{key:"onChange",value:function(){return function(e,t){this.validateAndSetValue(e,t)}}()},{key:"setHover",value:function(){return function(e){this.setState({hovered:e})}}()},{key:"validateAndSetValue",value:function(){return function(e,t){var n=this.props.validationErrors,r=this.validate(e);t&&t.length>0&&(r=n.concat(t)),n.length+r.length>0&&(n=r),e===this.props.value&&n===this.props.validationErrors||this.props.actions.setControlValue(this.props.name,e,n)}}()},{key:"validate",value:function(){return function(e){var t=this.props.validators,n=[];return t&&t.length>0&&t.forEach(function(t){var r=t(e);r&&n.push(r)}),n}}()},{key:"render",value:function(){return function(){var e=i.default[this.props.type],t=this.props.hidden?{display:"none"}:null;return o.default.createElement("div",{style:t,onMouseEnter:this.setHover.bind(this,!0),onMouseLeave:this.setHover.bind(this,!1)},o.default.createElement(e,r({onChange:this.onChange,hovered:this.state.hovered},this.props)))}}()}]),t}();t.default=f,f.propTypes=c,f.defaultProps={renderTrigger:!1,validators:[],hidden:!1,validationErrors:[]}},1194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=h(n(1)),l=h(n(0)),i=n(12),u=n(41),s=n(221),c=n(271),f=h(n(66)),d=h(n(1195)),p=n(11);function h(e){return e&&e.__esModule?e:{default:e}}var m={colorScheme:l.default.string.isRequired,annotationError:l.default.object,annotationQuery:l.default.object,vizType:l.default.string,validationErrors:l.default.array,name:l.default.string.isRequired,actions:l.default.object,value:l.default.arrayOf(l.default.object),onChange:l.default.func,refreshAnnotationData:l.default.func},y={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:function(){return function(){}}()},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.addAnnotationLayer=n.addAnnotationLayer.bind(n),n.removeAnnotationLayer=n.removeAnnotationLayer.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),a(t,[{key:"componentWillReceiveProps",value:function(){return function(e){var t=e.name,n=e.annotationError,r=e.validationErrors,a=e.value;Object.keys(n).length&&!r.length&&this.props.actions.setControlValue(t,a,Object.keys(n)),!Object.keys(n).length&&r.length&&this.props.actions.setControlValue(t,a,[])}}()},{key:"addAnnotationLayer",value:function(){return function(e){var t=e,n=this.props.value.slice(),r=n.findIndex(function(e){return e.name===(t.oldName||t.name)});delete t.oldName,r>-1?n[r]=t:n=n.concat(t),this.props.refreshAnnotationData(t),this.props.onChange(n)}}()},{key:"removeAnnotationLayer",value:function(){return function(e){var t=this.props.value.slice().filter(function(t){return t.name!==e.oldName});this.props.onChange(t)}}()},{key:"renderPopover",value:function(){return function(e,t,n){var a=this,l=t?t.name:"_new";return o.default.createElement(i.Popover,{style:{maxWidth:"none"},title:t?(0,p.t)("Edit Annotation Layer"):(0,p.t)("Add Annotation Layer"),id:"annotation-pop-"+l},o.default.createElement(d.default,r({},t,{error:n,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:this.addAnnotationLayer,removeAnnotationLayer:this.removeAnnotationLayer,close:function(){return a.refs[e].hide()}})))}}()},{key:"renderInfo",value:function(){return function(e){var t=this.props,n=t.annotationError;return t.annotationQuery[e.name]?o.default.createElement("i",{className:"fa fa-refresh",style:{color:"orange"},"aria-hidden":!0}):n[e.name]?o.default.createElement(f.default,{label:"validation-errors",bsStyle:"danger",tooltip:n[e.name]}):e.show?"":o.default.createElement("span",{style:{color:"red"}}," Hidden ")}}()},{key:"render",value:function(){return function(){var e=this,t=this.props.value.map(function(t,n){return o.default.createElement(i.OverlayTrigger,{key:n,trigger:"click",rootClose:!0,ref:"overlay-"+n,placement:"right",overlay:e.renderPopover("overlay-"+n,t,e.props.annotationError[t.name])},o.default.createElement(i.ListGroupItem,null,o.default.createElement("span",null,t.name),o.default.createElement("span",{style:{float:"right"}},e.renderInfo(t))))});return o.default.createElement("div",null,o.default.createElement(i.ListGroup,null,t,o.default.createElement(i.OverlayTrigger,{trigger:"click",rootClose:!0,ref:"overlay-new",placement:"right",overlay:this.renderPopover("overlay-new")},o.default.createElement(i.ListGroupItem,null,o.default.createElement("i",{className:"fa fa-plus"}),"   ",(0,p.t)("Add Annotation Layer")))))}}()}]),t}();v.propTypes=m,v.defaultProps=y,t.default=(0,u.connect)(function(e){var t=e.charts,n=e.explore,r=(0,s.getChartKey)(n);return{colorScheme:(n.controls||{}).color_scheme.value,annotationError:t[r].annotationError,annotationQuery:t[r].annotationQuery,vizType:n.controls.viz_type.value}},function(e){return{refreshAnnotationData:function(t){return e((0,c.runAnnotationQuery)(t))}}})(v)},1195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=C(n(1)),o=C(n(0)),l=n(803),i=n(12),u=C(n(22)),s=C(n(1179)),c=C(n(407)),f=C(n(453)),d=C(n(550)),p=n(555),h=C(p),m=n(240),y=C(n(551)),v=C(n(65)),g=n(270),b=C(n(268)),E=n(11);function C(e){return e&&e.__esModule?e:{default:e}}var O="",_={name:o.default.string,annotationType:o.default.string,sourceType:o.default.string,color:o.default.string,opacity:o.default.string,style:o.default.string,width:o.default.number,showMarkers:o.default.bool,hideLine:o.default.bool,value:o.default.oneOfType([o.default.string,o.default.number]),overrides:o.default.object,show:o.default.bool,titleColumn:o.default.string,descriptionColumns:o.default.arrayOf(o.default.string),timeColumn:o.default.string,intervalEndColumn:o.default.string,vizType:o.default.string,error:o.default.string,colorScheme:o.default.string,addAnnotationLayer:o.default.func,removeAnnotationLayer:o.default.func,close:o.default.func},S={name:"",annotationType:p.DEFAULT_ANNOTATION_TYPE,sourceType:"",color:O,opacity:"",style:"solid",width:1,showMarkers:!1,hideLine:!1,overrides:{},colorScheme:"d3Category10",show:!0,titleColumn:"",descriptionColumns:[],timeColumn:"",intervalEndColumn:"",addAnnotationLayer:function(){return function(){}}(),removeAnnotationLayer:function(){return function(){}}(),close:function(){return function(){}}()},T=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.name,a=e.annotationType,o=e.sourceType,l=e.color,i=e.opacity,u=e.style,s=e.width,c=e.showMarkers,f=e.hideLine,d=e.value,p=e.overrides,h=e.show,m=e.titleColumn,y=e.descriptionColumns,v=e.timeColumn,g=e.intervalEndColumn;return n.state={name:r,oldName:n.props.name?r:null,annotationType:a,sourceType:o,value:d,overrides:p,show:h,titleColumn:m,descriptionColumns:y,timeColumn:v,intervalEndColumn:g,color:l||O,opacity:i,style:u,width:s,showMarkers:c,hideLine:f,isNew:!n.props.name,isLoadingOptions:!0,valueOptions:[],validationErrors:{}},n.submitAnnotation=n.submitAnnotation.bind(n),n.deleteAnnotation=n.deleteAnnotation.bind(n),n.applyAnnotation=n.applyAnnotation.bind(n),n.fetchOptions=n.fetchOptions.bind(n),n.handleAnnotationType=n.handleAnnotationType.bind(n),n.handleAnnotationSourceType=n.handleAnnotationSourceType.bind(n),n.handleValue=n.handleValue.bind(n),n.isValidForm=n.isValidForm.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"componentDidMount",value:function(){return function(){var e=this.state,t=e.annotationType,n=e.sourceType,r=e.isLoadingOptions;this.fetchOptions(t,n,r)}}()},{key:"componentDidUpdate",value:function(){return function(e,t){t.sourceType!==this.state.sourceType&&this.fetchOptions(this.state.annotationType,this.state.sourceType,!0)}}()},{key:"isValidFormula",value:function(){return function(e,t){if(t===h.default.FORMULA)try{s.default.parse(e).compile().eval({x:0})}catch(e){return!0}return!1}}()},{key:"isValidForm",value:function(){return function(){var e=this.state,t=e.name,n=e.annotationType,r=e.sourceType,a=e.value,o=e.timeColumn,l=e.intervalEndColumn,i=[(0,g.nonEmpty)(t),(0,g.nonEmpty)(n),(0,g.nonEmpty)(a)];return r!==p.ANNOTATION_SOURCE_TYPES.NATIVE&&(n===h.default.EVENT&&i.push((0,g.nonEmpty)(o)),n===h.default.INTERVAL&&(i.push((0,g.nonEmpty)(o)),i.push((0,g.nonEmpty)(l)))),i.push(this.isValidFormula(a,n)),!i.filter(function(e){return e}).length}}()},{key:"handleAnnotationType",value:function(){return function(e){this.setState({annotationType:e,sourceType:null,validationErrors:{},value:null})}}()},{key:"handleAnnotationSourceType",value:function(){return function(e){this.setState({sourceType:e,isLoadingOptions:!0,validationErrors:{},value:null})}}()},{key:"handleValue",value:function(){return function(e){this.setState({value:e,descriptionColumns:null,intervalEndColumn:null,timeColumn:null,titleColumn:null,overrides:{since:null,until:null}})}}()},{key:"fetchOptions",value:function(){return function(e,t,n){var r=this;!0===n&&(t===p.ANNOTATION_SOURCE_TYPES.NATIVE?u.default.ajax({type:"GET",url:"/annotationlayermodelview/api/read?"}).then(function(e){var t=e?e.result.map(function(e){return{value:e.id,label:e.name}}):[];r.setState({isLoadingOptions:!1,valueOptions:t})}):(0,p.requiresQuery)(t)?u.default.ajax({type:"GET",url:"/superset/user_slices"}).then(function(t){return r.setState({isLoadingOptions:!1,valueOptions:t.filter(function(t){return(0,p.getSupportedSourceTypes)(e).find(function(e){return e===t.viz_type})}).map(function(e){return{value:e.id,label:e.title,slice:e}})})}):this.setState({isLoadingOptions:!1,valueOptions:[]}))}}()},{key:"deleteAnnotation",value:function(){return function(){this.props.close(),this.state.isNew||this.props.removeAnnotationLayer(this.state)}}()},{key:"applyAnnotation",value:function(){return function(){var e=this;if(this.state.name.length){var t={};Object.keys(this.state).forEach(function(n){null!==e.state[n]&&(t[n]=e.state[n])}),delete t.isNew,delete t.valueOptions,delete t.isLoadingOptions,delete t.validationErrors,t.color=t.color===O?null:t.color,this.props.addAnnotationLayer(t),this.setState({isNew:!1,oldName:this.state.name})}}}()},{key:"submitAnnotation",value:function(){return function(){this.applyAnnotation(),this.props.close()}}()},{key:"renderValueConfiguration",value:function(){return function(){var e=this.state,t=e.annotationType,n=e.sourceType,r=e.value,o=e.valueOptions,l=e.isLoadingOptions,i="",u="";return(0,p.requiresQuery)(n)?n===p.ANNOTATION_SOURCE_TYPES.NATIVE?(i="Annotation Layer",u="Select the Annotation Layer you would like to use."):(i="Slice",u="Use a pre defined Superset Slice as a source for annotations and overlays. \n        'your chart must be one of these visualization types:\n        '["+(0,p.getSupportedSourceTypes)(t).map(function(e){return b.default[e].label}).join(", ")+"]'"):t===h.default.FORMULA&&(i="Formula",u="Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'"),(0,p.requiresQuery)(n)?a.default.createElement(c.default,{name:"annotation-layer-value",showHeader:!0,hovered:!0,description:u,label:i,placeholder:"",options:o,isLoading:l,value:r,onChange:this.handleValue,validationErrors:r?[]:["Mandatory"]}):t===h.default.FORMULA?a.default.createElement(f.default,{name:"annotation-layer-value",hovered:!0,showHeader:!0,description:u,label:i,placeholder:"",value:r,onChange:this.handleValue,validationErrors:this.isValidFormula(r,t)?["Bad formula."]:[]}):""}}()},{key:"renderSliceConfiguration",value:function(){return function(){var e=this,t=this.state,n=t.annotationType,r=t.sourceType,o=t.value,l=t.valueOptions,i=t.overrides,u=t.titleColumn,s=t.timeColumn,m=t.intervalEndColumn,v=t.descriptionColumns,g=(l.find(function(e){return e.value===o})||{}).slice;if(r!==p.ANNOTATION_SOURCE_TYPES.NATIVE&&g){var b=(g.data.groupby||[]).concat(g.data.all_columns||[]).map(function(e){return{value:e,label:e}}),E=g.data.include_time?[{value:"__timestamp",label:"__timestamp"}].concat(b):b;return a.default.createElement("div",{style:{marginRight:"2rem"}},a.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:"Annotation Slice Configuration",info:"This section allows you to configure how to use the slice\n               to generate annotations."},(n===h.default.EVENT||n===h.default.INTERVAL)&&a.default.createElement(c.default,{hovered:!0,name:"annotation-layer-time-column",label:n===h.default.INTERVAL?"Interval Start column":"Event Time Column",description:"This column must contain date/time information.",validationErrors:s?[]:["Mandatory"],clearable:!1,options:E,value:s,onChange:function(t){return e.setState({timeColumn:t})}}),n===h.default.INTERVAL&&a.default.createElement(c.default,{hovered:!0,name:"annotation-layer-intervalEnd",label:"Interval End column",description:"This column must contain date/time information.",validationErrors:m?[]:["Mandatory"],options:b,value:m,onChange:function(t){return e.setState({intervalEndColumn:t})}}),a.default.createElement(c.default,{hovered:!0,name:"annotation-layer-title",label:"Title Column",description:"Pick a title for you annotation.",options:[{value:"",label:"None"}].concat(b),value:u,onChange:function(t){return e.setState({titleColumn:t})}}),n!==h.default.TIME_SERIES&&a.default.createElement(c.default,{hovered:!0,name:"annotation-layer-title",label:"Description Columns",description:"Pick one or more columns that should be shown in the\n                  annotation. If you don't select a column all of them will be shown.",multi:!0,options:b,value:v,onChange:function(t){return e.setState({descriptionColumns:t})}}),a.default.createElement("div",{style:{marginTop:"1rem"}},a.default.createElement(d.default,{hovered:!0,name:"annotation-override-since",label:"Override 'Since'",description:'This controls whether the "Since" field from the current\n                  view should be passed down to the chart containing the annotation data.',value:!!Object.keys(i).find(function(e){return"since"===e}),onChange:function(t){delete i.since,t?e.setState({overrides:Object.assign({},i,{since:null})}):e.setState({overrides:Object.assign({},i)})}}),a.default.createElement(d.default,{hovered:!0,name:"annotation-override-until",label:"Override 'Until'",description:'This controls whether the "Until" field from the current\n                  view should be passed down to the chart containing the annotation data.',value:!!Object.keys(i).find(function(e){return"until"===e}),onChange:function(t){delete i.until,t?e.setState({overrides:Object.assign({},i,{until:null})}):e.setState({overrides:Object.assign({},i)})}}),a.default.createElement(d.default,{hovered:!0,name:"annotation-override-timegrain",label:"Override time grain",description:"This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.",value:!!Object.keys(i).find(function(e){return"time_grain_sqla"===e}),onChange:function(t){delete i.time_grain_sqla,delete i.granularity,t?e.setState({overrides:Object.assign({},i,{time_grain_sqla:null,granularity:null})}):e.setState({overrides:Object.assign({},i)})}}),a.default.createElement(f.default,{hovered:!0,name:"annotation-layer-timeshift",label:"Time Shift",description:"Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)",placeholder:"",value:i.time_shift,onChange:function(t){return e.setState({overrides:Object.assign({},i,{time_shift:t})})}}))))}return""}}()},{key:"renderDisplayConfiguration",value:function(){return function(){var e=this,t=this.state,n=t.color,r=t.opacity,o=t.style,u=t.width,s=t.showMarkers,p=t.hideLine,g=t.annotationType,b=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(m.ALL_COLOR_SCHEMES[this.props.colorScheme]));return n&&n!==O&&!b.find(function(e){return e.toLowerCase()===n.toLowerCase()})&&b.push(n),a.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:(0,E.t)("Display configuration"),info:(0,E.t)("Configure your how you overlay is displayed here.")},a.default.createElement(c.default,{name:"annotation-layer-stroke",label:(0,E.t)("Style"),options:[{value:"solid",label:"Solid"},{value:"dashed",label:"Dashed"},{value:"longDashed",label:"Long Dashed"},{value:"dotted",label:"Dotted"}],value:o,onChange:function(t){return e.setState({style:t})}}),a.default.createElement(c.default,{name:"annotation-layer-opacity",label:(0,E.t)("Opacity"),options:[{value:"",label:"Solid"},{value:"opacityLow",label:"0.2"},{value:"opacityMedium",label:"0.5"},{value:"opacityHigh",label:"0.8"}],value:r,onChange:function(t){return e.setState({opacity:t})}}),a.default.createElement("div",null,a.default.createElement(v.default,{label:(0,E.t)("Color")}),a.default.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.default.createElement(l.CompactPicker,{color:n,colors:b,onChangeComplete:function(t){return e.setState({color:t.hex})}}),a.default.createElement(i.Button,{style:{marginTop:"0.5rem",marginBottom:"0.5rem"},bsStyle:n===O?"success":"default",bsSize:"xsmall",onClick:function(){return e.setState({color:O})}},"Automatic Color"))),a.default.createElement(f.default,{name:"annotation-layer-stroke-width",label:(0,E.t)("Line Width"),isInt:!0,value:u,onChange:function(t){return e.setState({width:t})}}),g===h.default.TIME_SERIES&&a.default.createElement(d.default,{hovered:!0,name:"annotation-layer-show-markers",label:"Show Markers",description:"Shows or hides markers for the time series",value:s,onChange:function(t){return e.setState({showMarkers:t})}}),g===h.default.TIME_SERIES&&a.default.createElement(d.default,{hovered:!0,name:"annotation-layer-hide-line",label:"Hide Line",description:"Hides the Line for the time series",value:p,onChange:function(t){return e.setState({hideLine:t})}}))}}()},{key:"render",value:function(){return function(){var e=this,t=this.state,n=t.isNew,r=t.name,o=t.annotationType,l=t.sourceType,u=t.show,s=this.isValidForm();return a.default.createElement("div",null,this.props.error&&a.default.createElement("span",{style:{color:"red"}},"ERROR: ",this.props.error),a.default.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.default.createElement("div",{style:{marginRight:"2rem"}},a.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:(0,E.t)("Layer Configuration"),info:(0,E.t)("Configure the basics of your Annotation Layer.")},a.default.createElement(f.default,{name:"annotation-layer-name",label:(0,E.t)("Name"),placeholder:"",value:r,onChange:function(t){return e.setState({name:t})},validationErrors:r?[]:[(0,E.t)("Mandatory")]}),a.default.createElement(d.default,{name:"annotation-layer-hide",label:(0,E.t)("Hide Layer"),value:!u,onChange:function(t){return e.setState({show:!t})}}),a.default.createElement(c.default,{hovered:!0,description:(0,E.t)("Choose the Annotation Layer Type"),label:(0,E.t)("Annotation Layer Type"),name:"annotation-layer-type",options:(0,p.getSupportedAnnotationTypes)(this.props.vizType).map(function(e){return{value:e,label:(0,p.getAnnotationTypeLabel)(e)}}),value:o,onChange:this.handleAnnotationType}),!!(0,p.getSupportedSourceTypes)(o).length&&a.default.createElement(c.default,{hovered:!0,description:"Choose the source of your annotations",label:"Annotation Source",name:"annotation-source-type",options:(0,p.getSupportedSourceTypes)(o).map(function(e){return{value:e,label:(0,p.getAnnotationSourceTypeLabels)(e)}}),value:l,onChange:this.handleAnnotationSourceType}),this.renderValueConfiguration())),this.renderSliceConfiguration(),this.renderDisplayConfiguration()),a.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},a.default.createElement(i.Button,{bsSize:"sm",onClick:this.deleteAnnotation},n?(0,E.t)("Cancel"):(0,E.t)("Remove")),a.default.createElement("div",null,a.default.createElement(i.Button,{bsSize:"sm",disabled:!s,onClick:this.applyAnnotation},(0,E.t)("Apply")),a.default.createElement(i.Button,{bsSize:"sm",disabled:!s,onClick:this.submitAnnotation},(0,E.t)("OK")))))}}()}]),t}();t.default=T,T.propTypes=_,T.defaultProps=S},1708:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=p(n(1)),l=p(n(0)),i=n(12),u=p(n(53)),s=n(1709),c=p(n(66)),f=p(n(65)),d=p(n(802));function p(e){return e&&e.__esModule?e:{default:e}}var h={name:l.default.string.isRequired,label:l.default.string,description:l.default.string,placeholder:l.default.string,addTooltip:l.default.string,itemGenerator:l.default.func,keyAccessor:l.default.func,onChange:l.default.func,value:l.default.oneOfType([l.default.array]),isFloat:l.default.bool,isInt:l.default.bool,controlName:l.default.string.isRequired},m={label:null,description:null,onChange:function(){return function(){}}(),placeholder:"Empty collection",itemGenerator:function(){return function(){return{key:u.default.generate()}}}(),keyAccessor:function(){return function(e){return e.key}}(),value:[],addTooltip:"Add an item"},y=(0,s.SortableElement)(i.ListGroupItem),v=(0,s.SortableContainer)(i.ListGroup),g=(0,s.SortableHandle)(function(){return o.default.createElement("i",{className:"fa fa-bars text-primary",style:{cursor:"ns-resize"}})}),b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onAdd=n.onAdd.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"onChange",value:function(){return function(e,t){Object.assign(this.props.value[e],t),this.props.onChange(this.props.value)}}()},{key:"onAdd",value:function(){return function(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}}()},{key:"onSortEnd",value:function(){return function(e){var t=e.oldIndex,n=e.newIndex;this.props.onChange((0,s.arrayMove)(this.props.value,t,n))}}()},{key:"removeItem",value:function(){return function(e){this.props.onChange(this.props.value.filter(function(t,n){return e!==n}))}}()},{key:"renderList",value:function(){return function(){var e=this;if(0===this.props.value.length)return o.default.createElement("div",{className:"text-muted"},this.props.placeholder);var t=d.default[this.props.controlName];return o.default.createElement(v,{useDragHandle:!0,lockAxis:"y",onSortEnd:this.onSortEnd.bind(this)},this.props.value.map(function(n,a){return o.default.createElement(y,{className:"clearfix",key:e.props.keyAccessor(n),index:a},o.default.createElement("div",{className:"pull-left m-r-5"},o.default.createElement(g,null)),o.default.createElement("div",{className:"pull-left"},o.default.createElement(t,r({},n,{onChange:e.onChange.bind(e,a)}))),o.default.createElement("div",{className:"pull-right"},o.default.createElement(c.default,{icon:"times",label:"remove-item",tooltip:"remove item",bsStyle:"primary",onClick:e.removeItem.bind(e,a)})))}))}}()},{key:"render",value:function(){return function(){return o.default.createElement("div",null,o.default.createElement(f.default,this.props),this.renderList(),o.default.createElement(c.default,{icon:"plus-circle",label:"add-item",tooltip:this.props.addTooltip,bsStyle:"primary",className:"fa-lg",onClick:this.onAdd}))}}()}]),t}();t.default=b,b.propTypes=h,b.defaultProps=m},1714:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=c(n(1)),o=c(n(0)),l=n(12),i=n(803),u=c(n(65)),s=n(240);function c(e){return e&&e.__esModule?e:{default:e}}var f={onChange:o.default.func,value:o.default.object},d={onChange:function(){return function(){}}()},p={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},h={swatch:{width:"50px",height:"20px",position:"relative",padding:"5px",borderRadius:"1px",display:"inline-block",cursor:"pointer",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset, rgba(0, 0, 0, 0.25) 0px 0px 4px inset"},color:Object.assign({},p,{borderRadius:"2px"}),checkboard:Object.assign({},p,{background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'})},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onChange",value:function(){return function(e){this.props.onChange(e.rgb)}}()},{key:"renderPopover",value:function(){return function(){return a.default.createElement(l.Popover,{id:"filter-popover",className:"color-popover"},a.default.createElement(i.SketchPicker,{color:this.props.value,onChange:this.onChange,presetColors:s.bnbColors.filter(function(e,t){return t<7})}))}}()},{key:"render",value:function(){return function(){var e=this.props.value||{r:0,g:0,b:0,a:0},t=Object.assign({},h.color,{background:"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"});return a.default.createElement("div",null,a.default.createElement(u.default,this.props),a.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},a.default.createElement("div",{style:h.swatch},a.default.createElement("div",{style:h.checkboard}),a.default.createElement("div",{style:t}))))}}()}]),t}();t.default=m,m.propTypes=f,m.defaultProps=d},1715:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=n(75),i=s(n(65)),u=n(240);function s(e){return e&&e.__esModule?e:{default:e}}var c={description:o.default.string,label:o.default.string.isRequired,name:o.default.string.isRequired,onChange:o.default.func,value:o.default.string,default:o.default.string,choices:o.default.arrayOf(o.default.array).isRequired,schemes:o.default.object.isRequired,isLinear:o.default.bool},f={choices:[],schemes:{},onChange:function(){return function(){}}()},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={scheme:n.props.value},n.onChange=n.onChange.bind(n),n.renderOption=n.renderOption.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(e){var t=e?e.value:null;this.props.onChange(t),this.setState({scheme:t})}}()},{key:"renderOption",value:function(){return function(e){var t=e.value?this.props.schemes[e.value]:this.props.schemes[f.value],n=t;if(this.props.isLinear){var r=(0,u.colorScalerFactory)(t);n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(20).keys())).map(function(e){return r(e/20)})}var o=n.map(function(e,n){return a.default.createElement("li",{key:t+"-"+n,style:{backgroundColor:e,border:"1px solid "+("white"===e?"black":e)}}," ")});return a.default.createElement("ul",{className:"color-scheme-container"},o)}}()},{key:"render",value:function(){return function(){var e={multi:!1,name:"select-"+this.props.name,placeholder:"Select ("+this.props.choices.length+")",default:this.props.default,options:this.props.choices.map(function(e){return{value:e[0],label:e[1]}}),value:this.props.value,autosize:!1,clearable:!1,onChange:this.onChange,optionRenderer:this.renderOption,valueRenderer:this.renderOption};return a.default.createElement("div",null,a.default.createElement(i.default,this.props),a.default.createElement(l.Creatable,e))}}()}]),t}();t.default=d,d.propTypes=c,d.defaultProps=f},1716:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=h(n(1)),o=h(n(0)),l=n(12),i=h(n(22)),u=h(n(65)),s=n(11),c=h(n(1717)),f=h(n(294)),d=h(n(609)),p=h(n(322));function h(e){return e&&e.__esModule?e:{default:e}}var m={onChange:o.default.func,value:o.default.string.isRequired,addDangerToast:o.default.func.isRequired,datasource:o.default.object.isRequired,onDatasourceSave:o.default.func},y={onChange:function(){return function(){}}(),onDatasourceSave:function(){return function(){}}()},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showEditDatasourceModal:!1,filter:"",loading:!0,showDatasource:!1},n.toggleShowDatasource=n.toggleShowDatasource.bind(n),n.toggleEditDatasourceModal=n.toggleEditDatasourceModal.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.selectDatasource=n.selectDatasource.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(e){this.props.onChange(e),this.setState({showModal:!1})}}()},{key:"onEnterModal",value:function(){return function(){var e=this;this.searchRef&&this.searchRef.focus();var t=this;this.state.datasources||i.default.ajax({type:"GET",url:"/superset/datasources/",success:function(n){var r=n.map(function(t){return{rawName:t.name,connection:t.connection,schema:t.schema,name:a.default.createElement("a",{href:"#",onClick:e.selectDatasource.bind(e,t.uid),className:"datasource-link"},t.name),type:t.type}});t.setState({loading:!1,datasources:r})},error:function(){t.setState({loading:!1}),this.props.addDangerToast((0,s.t)("Something went wrong while fetching the datasource list"))}})}}()},{key:"setSearchRef",value:function(){return function(e){this.searchRef=e}}()},{key:"toggleShowDatasource",value:function(){return function(){this.setState({showDatasource:!this.state.showDatasource})}}()},{key:"toggleModal",value:function(){return function(){this.setState({showModal:!this.state.showModal})}}()},{key:"changeSearch",value:function(){return function(e){this.setState({filter:e.target.value})}}()},{key:"selectDatasource",value:function(){return function(e){this.setState({showModal:!1}),this.props.onChange(e)}}()},{key:"toggleEditDatasourceModal",value:function(){return function(){this.setState({showEditDatasourceModal:!this.state.showEditDatasourceModal})}}()},{key:"renderModal",value:function(){return function(){}}()},{key:"renderDatasource",value:function(){return function(){var e=this.props.datasource;return a.default.createElement("div",{className:"m-t-10"},a.default.createElement(l.Well,{className:"m-t-0"},a.default.createElement("div",{className:"m-b-10"},a.default.createElement(l.Label,null,a.default.createElement("i",{className:"fa fa-database"})," ",e.database.backend)," "+e.database.name+" "),a.default.createElement(l.Row,{className:"datasource-container"},a.default.createElement(l.Col,{md:6},a.default.createElement("strong",null,"Columns"),e.columns.map(function(e){return a.default.createElement("div",{key:e.column_name},a.default.createElement(f.default,{showType:!0,column:e}))})),a.default.createElement(l.Col,{md:6},a.default.createElement("strong",null,"Metrics"),e.metrics.map(function(e){return a.default.createElement("div",{key:e.metric_name},a.default.createElement(d.default,{metric:e,showType:!0}))})))))}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement(u.default,this.props),a.default.createElement(l.OverlayTrigger,{placement:"right",overlay:a.default.createElement(l.Tooltip,{id:"error-tooltip"},(0,s.t)("Click to point to another datasource"))},a.default.createElement(l.Label,{onClick:this.toggleEditDatasourceModal,style:{cursor:"pointer"},className:"m-r-5"},this.props.datasource.name)),a.default.createElement(l.OverlayTrigger,{placement:"right",overlay:a.default.createElement(l.Tooltip,{id:"toggle-datasource-tooltip"},(0,s.t)("Expand/collapse datasource configuration"))},a.default.createElement("a",{href:"#"},a.default.createElement("i",{className:"fa fa-"+(this.state.showDatasource?"minus":"plus")+"-square m-r-5",onClick:this.toggleShowDatasource}))),"table"===this.props.datasource.type&&a.default.createElement(l.OverlayTrigger,{placement:"right",overlay:a.default.createElement(l.Tooltip,{id:"datasource-sqllab"},(0,s.t)("Run SQL queries against this datasource"))},a.default.createElement("a",{href:"/superset/sqllab?datasourceKey="+this.props.value},a.default.createElement("i",{className:"fa fa-flask m-r-5"}))),a.default.createElement(l.Collapse,{in:this.state.showDatasource},this.renderDatasource()),a.default.createElement(c.default,{datasource:this.props.datasource,show:this.state.showEditDatasourceModal,onDatasourceSave:this.props.onDatasourceSave,onHide:this.toggleEditDatasourceModal}))}}()}]),t}();v.propTypes=m,v.defaultProps=y,t.default=(0,p.default)(v)},1717:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=d(n(1)),o=d(n(0)),l=n(12),i=d(n(637)),u=d(n(22)),s=n(11),c=d(n(1718)),f=d(n(322));function d(e){return e&&e.__esModule?e:{default:e}}var p={onChange:o.default.func,datasource:o.default.object.isRequired,show:o.default.bool.isRequired,onHide:o.default.func,onDatasourceSave:o.default.func,addSuccessToast:o.default.func.isRequired},h={onChange:function(){return function(){}}(),onHide:function(){return function(){}}(),onDatasourceSave:function(){return function(){}}(),show:!1},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showEditDatasource:!1,filter:"",loading:!0,errors:[],showDatasource:!1,datasource:e.datasource},n.toggleShowDatasource=n.toggleShowDatasource.bind(n),n.changeSearch=n.changeSearch.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.onDatasourceChange=n.onDatasourceChange.bind(n),n.onClickSave=n.onClickSave.bind(n),n.onConfirmSave=n.onConfirmSave.bind(n),n.setDialogRef=n.setDialogRef.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onClickSave",value:function(){return function(){this.dialog.show({title:"Confirm save",bsSize:"medium",actions:[i.default.CancelAction(),i.default.OKAction(this.onConfirmSave)],body:this.renderSaveDialog()})}}()},{key:"onConfirmSave",value:function(){return function(){var e=this,t=this;u.default.ajax({url:"/datasource/save/",type:"POST",data:{data:JSON.stringify(this.state.datasource)},success:function(t){e.props.addSuccessToast((0,s.t)("The datasource has been saved")),e.props.onDatasourceSave(t),e.props.onHide()},error:function(e){var n=(0,s.t)("An error has occurred");e.responseJSON&&e.responseJSON.error&&(n=e.responseJSON.error),t.dialog.show({title:"Error",bsSize:"medium",bsStyle:"danger",actions:[i.default.DefaultAction("Ok",function(){},"btn-danger")],body:n})}})}}()},{key:"onDatasourceChange",value:function(){return function(e,t){this.setState({datasource:e,errors:t})}}()},{key:"setSearchRef",value:function(){return function(e){this.searchRef=e}}()},{key:"setDialogRef",value:function(){return function(e){this.dialog=e}}()},{key:"toggleShowDatasource",value:function(){return function(){this.setState({showDatasource:!this.state.showDatasource})}}()},{key:"changeSearch",value:function(){return function(e){this.setState({filter:e.target.value})}}()},{key:"renderSaveDialog",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement(l.Alert,{bsStyle:"warning",className:"pointer",onClick:this.hideAlert},a.default.createElement("div",null,a.default.createElement("i",{className:"fa fa-exclamation-triangle"})," ",(0,s.t)("The data source configuration exposed here\n                affects all the charts using this datasource.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways."))),(0,s.t)("Are you sure you want to save and apply changes?"))}}()},{key:"render",value:function(){return function(){return a.default.createElement(l.Modal,{show:this.props.show,onHide:this.props.onHide,bsSize:"lg"},a.default.createElement(l.Modal.Header,{closeButton:!0},a.default.createElement(l.Modal.Title,null,a.default.createElement("div",null,a.default.createElement("span",{className:"float-left"},(0,s.t)("Datasource Editor for "),a.default.createElement("strong",null,this.props.datasource.name))))),a.default.createElement(l.Modal.Body,null,this.props.show&&a.default.createElement(c.default,{datasource:this.props.datasource,onChange:this.onDatasourceChange})),a.default.createElement(l.Modal.Footer,null,a.default.createElement("span",{className:"float-right"},a.default.createElement(l.Button,{bsSize:"sm",bsStyle:"primary",className:"m-r-5",onClick:this.onClickSave,disabled:this.state.errors.length>0},(0,s.t)("Save")),a.default.createElement(l.Button,{bsSize:"sm",onClick:this.props.onHide},(0,s.t)("Cancel")),a.default.createElement(i.default,{ref:this.setDialogRef}))))}}()}]),t}();m.propTypes=p,m.defaultProps=h,t.default=(0,f.default)(m)},1718:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatasourceEditor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=_(n(1)),o=_(n(0)),l=n(12),i=_(n(53)),u=_(n(22)),s=n(11),c=_(n(68)),f=_(n(78)),d=_(n(550)),p=_(n(453)),h=_(n(407)),m=_(n(885)),y=_(n(886)),v=_(n(887)),g=_(n(1721)),b=_(n(372)),E=_(n(889)),C=_(n(891)),O=_(n(322));function _(e){return e&&e.__esModule?e:{default:e}}function S(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}n(1726);var T=function(){return function(e,t){return a.default.createElement(d.default,{value:e,onChange:t})}}(),w={fontFamily:"monospace"},j=["STRING","NUMBER","DATETIME"];function k(e){var t=e.title,n=e.collection;return a.default.createElement("div",null,t," ",a.default.createElement(l.Badge,null,n?n.length:0))}function R(e){var t=e.columns,n=e.onChange,r=e.editableColumnName,o=e.showExpression,i=e.allowAddItem,u=e.allowEditDataType,c=e.itemGenerator;return a.default.createElement(g.default,{collection:t,tableColumns:["column_name","type","is_dttm","filterable","groupby"],allowDeletes:!0,allowAddItem:i,itemGenerator:c,expandFieldset:a.default.createElement(P,null,a.default.createElement(E.default,{compact:!0},o&&a.default.createElement(C.default,{fieldKey:"expression",label:"SQL Expression",control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{fieldKey:"verbose_name",label:(0,s.t)("Label"),control:a.default.createElement(p.default,null)}),u&&a.default.createElement(C.default,{fieldKey:"type",label:(0,s.t)("Data Type"),control:a.default.createElement(h.default,{choices:j,name:"type"})}),a.default.createElement(C.default,{fieldKey:"python_date_format",label:"Datetime Format",descr:a.default.createElement("div",null,(0,s.t)("The pattern of the timestamp format, use "),a.default.createElement("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},(0,s.t)("python datetime string pattern")),(0,s.t)(" expression. If time is stored in epoch format, put `epoch_s` or\n                      `epoch_ms`. Leave `Database Expression`\n                      below empty if timestamp is stored in '\n                      String or Integer(epoch) type")),control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{fieldKey:"database_expression",label:"Database Expression",descr:a.default.createElement("div",null,(0,s.t)("\n                    The database expression to cast internal datetime\n                    constants to database date/timestamp type according to the DBAPI.\n                    The expression should follow the pattern of\n                    %Y-%m-%d %H:%M:%S, based on different DBAPI.\n                    The string should be a python string formatter\n                    `Ex: TO_DATE('{}', 'YYYY-MM-DD HH24:MI:SS')` for Oracle\n                    Superset uses default expression based on DB URI if this\n                    field is blank.\n                  ")),control:a.default.createElement(p.default,null)}))),columnLabels:{column_name:"Column",type:"Data Type",groupby:"Is Dimension",is_dttm:"Is Temporal",filterable:"Is Filterable"},onChange:n,itemRenderers:{column_name:function(){return function(e,t){return r?a.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t}):e}}(),type:function(){return function(e){return a.default.createElement(l.Label,{style:{fontSize:"75%"}},e)}}(),is_dttm:T,filterable:T,groupby:T}})}function x(e){var t=e.label,n=e.formElement;return a.default.createElement("div",null,a.default.createElement("div",null,a.default.createElement("strong",null,t)),a.default.createElement("div",null,n))}function P(e){var t=e.children;return a.default.createElement(l.Well,{style:{marginTop:20}},t)}k.propTypes={title:o.default.string,collection:o.default.array},R.propTypes={columns:o.default.array.isRequired,onChange:o.default.func.isRequired,editableColumnName:o.default.bool,showExpression:o.default.bool,allowAddItem:o.default.bool,allowEditDataType:o.default.bool,itemGenerator:o.default.func},R.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:function(){return function(){return{column_name:"<new column>",filterable:!0,groupby:!0}}}()},x.propTypes={label:o.default.string,formElement:o.default.node},P.propTypes={children:o.default.node};var M={datasource:o.default.object.isRequired,onChange:o.default.func,addSuccessToast:o.default.func.isRequired,addDangerToast:o.default.func.isRequired},A={onChange:function(){return function(){}}()},N=t.DatasourceEditor=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={datasource:e.datasource,showAlert:!0,errors:[],isDruid:"druid"===e.datasource.type,isSqla:"table"===e.datasource.type,databaseColumns:e.datasource.columns.filter(function(e){return!e.expression}),calculatedColumns:e.datasource.columns.filter(function(e){return!!e.expression}),metadataLoading:!1,activeTabKey:1},n.onChange=n.onChange.bind(n),n.onDatasourcePropChange=n.onDatasourcePropChange.bind(n),n.onDatasourceChange=n.onDatasourceChange.bind(n),n.hideAlert=n.hideAlert.bind(n),n.syncMetadata=n.syncMetadata.bind(n),n.setColumns=n.setColumns.bind(n),n.validateAndChange=n.validateAndChange.bind(n),n.handleTabSelect=n.handleTabSelect.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(){var e=Object.assign({},this.state.datasource,{columns:[].concat(S(this.state.databaseColumns),S(this.state.calculatedColumns))});this.props.onChange(e,this.state.errors)}}()},{key:"onDatasourceChange",value:function(){return function(e){this.setState({datasource:e},this.validateAndChange)}}()},{key:"onDatasourcePropChange",value:function(){return function(e,t){var n=Object.assign({},this.state.datasource,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t));this.setState({datasource:n},this.onDatasourceChange(n))}}()},{key:"setColumns",value:function(){return function(e){this.setState(e,this.validateAndChange)}}()},{key:"validateAndChange",value:function(){return function(){this.validate(this.onChange)}}()},{key:"mergeColumns",value:function(){return function(e){var t=this.state.databaseColumns,n=void 0,r=t.map(function(e){return e.column_name});e.forEach(function(e){r.indexOf(e.name)<0&&(t=t.concat([{id:i.default.generate(),column_name:e.name,type:e.type,groupby:!0,filterable:!0}]),n=!0)}),n&&this.setColumns({databaseColumns:t})}}()},{key:"syncMetadata",value:function(){return function(){var e=this,t=this.state.datasource,n="/datasource/external_metadata/"+t.type+"/"+t.id+"/";this.setState({metadataLoading:!0});var r=function(t){e.mergeColumns(t),e.props.addSuccessToast((0,s.t)("Metadata has been synced")),e.setState({metadataLoading:!1})},a=function(t){var n=(0,s.t)("An error has occurred");t.responseJSON&&t.responseJSON.error&&(n=t.responseJSON.error),e.props.addDangerToast(n),e.setState({metadataLoading:!1})};u.default.ajax({url:n,type:"GET",success:r,error:a})}}()},{key:"findDuplicates",value:function(){return function(e,t){var n={},r=[];return e.forEach(function(e){var a=t(e);a in n?r.push(a):n[a]=null}),r}}()},{key:"validate",value:function(){return function(e){var t=[],n=void 0,r=this.state.datasource;n=this.findDuplicates(r.columns,function(e){return e.column_name}),t=t.concat(n.map(function(e){return(0,s.t)("Column name [%s] is duplicated",e)})),n=this.findDuplicates(r.metrics,function(e){return e.metric_name}),t=t.concat(n.map(function(e){return(0,s.t)("Metric name [%s] is duplicated",e)}));var a=this.state.calculatedColumns.filter(function(e){return!e.expression&&!e.json});t=t.concat(a.map(function(e){return(0,s.t)("Calculated column [%s] requires an expression",e.column_name)})),this.setState({errors:t},e)}}()},{key:"hideAlert",value:function(){return function(){this.setState({showAlert:!1})}}()},{key:"handleTabSelect",value:function(){return function(e){this.setState({activeTabKey:e})}}()},{key:"renderSettingsFieldset",value:function(){return function(){var e=this.state.datasource;return a.default.createElement(E.default,{title:"Basic",item:e,onChange:this.onDatasourceChange},a.default.createElement(C.default,{fieldKey:"description",label:(0,s.t)("Description"),control:a.default.createElement(m.default,{language:"markdown",offerEditInModal:!1})}),a.default.createElement(C.default,{fieldKey:"default_endpoint",label:(0,s.t)("Default URL"),descr:(0,s.t)("Default URL to redirect to when accessing from the datasource list page"),control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{fieldKey:"filter_select",label:(0,s.t)("Autocomplete filters"),descr:(0,s.t)("Whether to populate autocomplete filters options"),control:a.default.createElement(d.default,null)}),a.default.createElement(C.default,{fieldKey:"owner",label:(0,s.t)("Owner"),descr:(0,s.t)("Owner of the datasource"),control:a.default.createElement(y.default,{dataEndpoint:"/users/api/read",multi:!1,mutator:function(e){return e.pks.map(function(t,n){return{value:t,label:e.result[n].first_name+" "+e.result[n].last_name}})}}),controlProps:{}}))}}()},{key:"renderAdvancedFieldset",value:function(){return function(){var e=this.state.datasource;return a.default.createElement(E.default,{title:"Advanced",item:e,onChange:this.onDatasourceChange},this.state.isSqla&&a.default.createElement(C.default,{fieldKey:"sql",label:(0,s.t)("SQL"),descr:(0,s.t)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:a.default.createElement(m.default,{language:"sql",offerEditInModal:!1})}),this.state.isDruid&&a.default.createElement(C.default,{fieldKey:"json",label:(0,s.t)("JSON"),descr:a.default.createElement("div",null,(0,s.t)("The JSON metric or post aggregation definition.")),control:a.default.createElement(m.default,{language:"json",offerEditInModal:!1})}),a.default.createElement(C.default,{fieldKey:"cache_timeout",label:(0,s.t)("Cache Timeout"),descr:(0,s.t)("The duration of time in seconds before the cache is invalidated"),control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{fieldKey:"offset",label:(0,s.t)("Hours offset"),control:a.default.createElement(p.default,null)}))}}()},{key:"renderSpatialTab",value:function(){return function(){var e=this.state.datasource.spatials;return a.default.createElement(l.Tab,{title:a.default.createElement(k,{collection:e,title:(0,s.t)("Spatial")}),eventKey:4},a.default.createElement(g.default,{tableColumns:["name","config"],onChange:this.onDatasourcePropChange.bind(this,"spatials"),itemGenerator:function(){return{name:"<new spatial>",type:"<no type>",config:null}},collection:e,allowDeletes:!0,itemRenderers:{name:function(e,t){return a.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},config:function(e,t){return a.default.createElement(v.default,{value:e,onChange:t,choices:datasource.all_cols})}}}))}}()},{key:"renderErrors",value:function(){return function(){return this.state.errors.length>0?a.default.createElement(l.Alert,{bsStyle:"danger"},this.state.errors.map(function(e){return a.default.createElement("div",{key:e},e)})):null}}()},{key:"renderMetricCollection",value:function(){return function(){return a.default.createElement(g.default,{tableColumns:["metric_name","verbose_name","expression"],expandFieldset:a.default.createElement(P,null,a.default.createElement(E.default,null,a.default.createElement(C.default,{fieldKey:"description",label:(0,s.t)("Description"),control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{fieldKey:"d3format",label:(0,s.t)("D3 Format"),control:a.default.createElement(p.default,null)}),a.default.createElement(C.default,{label:(0,s.t)("Warning Message"),fieldKey:"warning_text",description:(0,s.t)("Warning message to display in the metric selector"),control:a.default.createElement(p.default,null)}))),collection:this.state.datasource.metrics,onChange:this.onDatasourcePropChange.bind(this,"metrics"),itemGenerator:function(){return{metric_name:"<new metric>",verbose_name:"",expression:""}},itemRenderers:{metric_name:function(e,t){return a.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},verbose_name:function(e,t){return a.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},expression:function(e,t){return a.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t,style:w})},description:function(e,t,n){return a.default.createElement(x,{label:n,formElement:a.default.createElement(p.default,{value:e,onChange:t})})},d3format:function(e,t,n){return a.default.createElement(x,{label:n,formElement:a.default.createElement(p.default,{value:e,onChange:t})})}},allowDeletes:!0})}}()},{key:"render",value:function(){return function(){var e=this,t=this.state.datasource;return a.default.createElement("div",{className:"Datasource"},this.renderErrors(),a.default.createElement(l.Tabs,{id:"table-tabs",onSelect:this.handleTabSelect,defaultActiveKey:1},a.default.createElement(l.Tab,{eventKey:1,title:(0,s.t)("Settings")},1===this.state.activeTabKey&&a.default.createElement("div",null,a.default.createElement(l.Col,{md:6},a.default.createElement(P,null,this.renderSettingsFieldset())),a.default.createElement(l.Col,{md:6},a.default.createElement(P,null,this.renderAdvancedFieldset())))),a.default.createElement(l.Tab,{title:a.default.createElement(k,{collection:this.state.databaseColumns,title:(0,s.t)("Columns")}),eventKey:2},2===this.state.activeTabKey&&a.default.createElement("div",null,a.default.createElement(R,{columns:this.state.databaseColumns,onChange:function(t){return e.setColumns({databaseColumns:t})}}),a.default.createElement(c.default,{bsStyle:"primary",onClick:this.syncMetadata,className:"sync-from-source",disabled:!!t.sql,tooltip:t.sql?(0,s.t)("This option is not yet available for views"):null},(0,s.t)("Sync columns from source")),this.state.metadataLoading&&a.default.createElement(f.default,null))),a.default.createElement(l.Tab,{title:a.default.createElement(k,{collection:this.state.calculatedColumns,title:(0,s.t)("Calculated Columns")}),eventKey:3},3===this.state.activeTabKey&&a.default.createElement(R,{columns:this.state.calculatedColumns,onChange:function(t){return e.setColumns({calculatedColumns:t})},editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:function(){return{column_name:"<new column>",filterable:!0,groupby:!0,expression:"<enter SQL expression here>",__expanded:!0}}})),a.default.createElement(l.Tab,{title:a.default.createElement(k,{collection:t.metrics,title:(0,s.t)("Metrics")}),eventKey:4},4===this.state.activeTabKey&&this.renderMetricCollection())))}}()}]),t}();N.defaultProps=A,N.propTypes=M,t.default=(0,O.default)(N)},1721:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=c(n(1)),o=c(n(0)),l=c(n(53)),i=c(n(68)),u=c(n(889)),s=n(890);function c(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(1724);var d={collection:o.default.arrayOf(o.default.object).isRequired,itemGenerator:o.default.func,columnLabels:o.default.object,tableColumns:o.default.array.isRequired,onChange:o.default.func,itemRenderers:o.default.object,allowDeletes:o.default.bool,expandFieldset:o.default.node,emptyMessage:o.default.node,extraButtons:o.default.node,allowAddItem:o.default.bool},p={onChange:function(){return function(){}}(),itemRenderers:{},columnLabels:{},allowDeletes:!1,emptyMessage:"No entries",allowAddItem:!1,itemGenerator:function(){return function(){return{}}}(),expandFieldset:null,extraButtons:null};function h(e){var t={};return e.map(function(e){return Object.assign({},e,{id:e.id||l.default.generate()})}).forEach(function(e){t[e.id]=e}),t}((function(){return function(e){return a.default.createElement("div",{className:"frame"},e.children)}})()).propTypes={children:o.default.node};var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={expandedColumns:{},collection:h(e.collection)},n.renderItem=n.renderItem.bind(n),n.onAddItem=n.onAddItem.bind(n),n.renderExpandableSection=n.renderExpandableSection.bind(n),n.getLabel=n.getLabel.bind(n),n.onFieldsetChange=n.onFieldsetChange.bind(n),n.renderTableBody=n.renderTableBody.bind(n),n.changeCollection=n.changeCollection.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"componentWillReceiveProps",value:function(){return function(e){e.collection!==this.props.collection&&this.setState({collection:h(e.collection)})}}()},{key:"onCellChange",value:function(){return function(e,t,n){this.changeCollection(Object.assign({},this.state.collection,f({},e,Object.assign({},this.state.collection[e],f({},t,n)))))}}()},{key:"onAddItem",value:function(){return function(){var e=this.props.itemGenerator();e.id||(e=Object.assign({},e,{id:l.default.generate()})),this.changeCollection(Object.assign({},this.state.collection,f({},e.id,e)))}}()},{key:"onFieldsetChange",value:function(){return function(e){this.changeCollection(Object.assign({},this.state.collection,f({},e.id,e)))}}()},{key:"getLabel",value:function(){return function(e){var t=this.props.columnLabels,n=t[e]?t[e]:e;return n.startsWith("__")&&(n=""),n}}()},{key:"changeCollection",value:function(){return function(e){this.setState({collection:e}),this.props.onChange(Object.keys(e).map(function(t){return e[t]}))}}()},{key:"deleteItem",value:function(){return function(e){var t=Object.assign({},this.state.collection);delete t[e],this.changeCollection(t)}}()},{key:"effectiveTableColumns",value:function(){return function(){var e=this.props,t=e.tableColumns,n=e.allowDeletes,r=e.expandFieldset,a=n?t.concat(["__actions"]):t;return r?["__expand"].concat(a):a}}()},{key:"toggleExpand",value:function(){return function(e){this.onCellChange(e,"__expanded",!1),this.setState({expandedColumns:Object.assign({},this.state.expandedColumns,f({},e,!this.state.expandedColumns[e]))})}}()},{key:"renderHeaderRow",value:function(){return function(){var e=this,t=this.effectiveTableColumns();return a.default.createElement("thead",null,a.default.createElement("tr",null,this.props.expandFieldset&&a.default.createElement("th",{className:"tiny-cell"}),t.map(function(t){return a.default.createElement("th",{key:t},e.getLabel(t))}),this.props.allowDeletes&&a.default.createElement("th",{className:"tiny-cell"})))}}()},{key:"renderExpandableSection",value:function(){return function(e){var t=this,n=function(){return{item:e,onChange:t.onFieldsetChange}};return(0,s.recurseReactClone)(this.props.expandFieldset,u.default,n)}}()},{key:"renderCell",value:function(){return function(e,t){var n=this.props.itemRenderers[t],r=e[t],a=this.onCellChange.bind(this,e.id,t);return n?n(r,a,this.getLabel(t)):r}}()},{key:"renderItem",value:function(){return function(e){var t=this,n=this.props,r=n.tableColumns,o=n.allowDeletes,l=n.expandFieldset,i=!!this.state.expandedColumns[e.id]||e.__expanded,u=[];l&&u.push(a.default.createElement("td",{key:"__expand",className:"expand"},a.default.createElement("i",{className:"fa fa-caret-"+(i?"down":"right")+" text-primary pointer",onClick:this.toggleExpand.bind(this,e.id)}))),u=u.concat(r.map(function(n){return a.default.createElement("td",{key:n},t.renderCell(e,n))})),o&&u.push(a.default.createElement("td",{key:"__actions"},a.default.createElement("i",{className:"fa fa-close text-primary pointer",onClick:this.deleteItem.bind(this,e.id)})));var s=[a.default.createElement("tr",{className:"row",key:e.id},u)];return i&&s.push(a.default.createElement("tr",{className:"exp",key:"exp__"+e.id},a.default.createElement("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},a.default.createElement("div",null,this.renderExpandableSection(e))))),s}}()},{key:"renderEmptyCell",value:function(){return function(){return a.default.createElement("tr",null,a.default.createElement("td",{className:"empty-collection"},this.props.emptyMessage))}}()},{key:"renderTableBody",value:function(){return function(){var e=this,t=Object.keys(this.state.collection).map(function(t){return e.state.collection[t]}),n=t.length?t.map(function(t){return e.renderItem(t)}):this.renderEmptyCell();return a.default.createElement("tbody",null,n)}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",{className:"CRUD"},a.default.createElement("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody()),a.default.createElement("div",null,this.props.allowAddItem&&a.default.createElement(i.default,{bsStyle:"primary",onClick:this.onAddItem},a.default.createElement("i",{className:"fa fa-plus"})," Add Item"),this.props.extraButtons))}}()}]),t}();t.default=m,m.defaultProps=p,m.propTypes=d},1722:function(e,t,n){},1724:function(e,t,n){},1726:function(e,t,n){},1749:function(e,t,n){var r={"./af":900,"./af.js":900,"./ar":901,"./ar-dz":902,"./ar-dz.js":902,"./ar-kw":903,"./ar-kw.js":903,"./ar-ly":904,"./ar-ly.js":904,"./ar-ma":905,"./ar-ma.js":905,"./ar-sa":906,"./ar-sa.js":906,"./ar-tn":907,"./ar-tn.js":907,"./ar.js":901,"./az":908,"./az.js":908,"./be":909,"./be.js":909,"./bg":910,"./bg.js":910,"./bm":911,"./bm.js":911,"./bn":912,"./bn.js":912,"./bo":913,"./bo.js":913,"./br":914,"./br.js":914,"./bs":915,"./bs.js":915,"./ca":916,"./ca.js":916,"./cs":917,"./cs.js":917,"./cv":918,"./cv.js":918,"./cy":919,"./cy.js":919,"./da":920,"./da.js":920,"./de":921,"./de-at":922,"./de-at.js":922,"./de-ch":923,"./de-ch.js":923,"./de.js":921,"./dv":924,"./dv.js":924,"./el":925,"./el.js":925,"./en-au":926,"./en-au.js":926,"./en-ca":927,"./en-ca.js":927,"./en-gb":928,"./en-gb.js":928,"./en-ie":929,"./en-ie.js":929,"./en-il":930,"./en-il.js":930,"./en-nz":931,"./en-nz.js":931,"./eo":932,"./eo.js":932,"./es":933,"./es-do":934,"./es-do.js":934,"./es-us":935,"./es-us.js":935,"./es.js":933,"./et":936,"./et.js":936,"./eu":937,"./eu.js":937,"./fa":938,"./fa.js":938,"./fi":939,"./fi.js":939,"./fo":940,"./fo.js":940,"./fr":941,"./fr-ca":942,"./fr-ca.js":942,"./fr-ch":943,"./fr-ch.js":943,"./fr.js":941,"./fy":944,"./fy.js":944,"./gd":945,"./gd.js":945,"./gl":946,"./gl.js":946,"./gom-latn":947,"./gom-latn.js":947,"./gu":948,"./gu.js":948,"./he":949,"./he.js":949,"./hi":950,"./hi.js":950,"./hr":951,"./hr.js":951,"./hu":952,"./hu.js":952,"./hy-am":953,"./hy-am.js":953,"./id":954,"./id.js":954,"./is":955,"./is.js":955,"./it":956,"./it.js":956,"./ja":957,"./ja.js":957,"./jv":958,"./jv.js":958,"./ka":959,"./ka.js":959,"./kk":960,"./kk.js":960,"./km":961,"./km.js":961,"./kn":962,"./kn.js":962,"./ko":963,"./ko.js":963,"./ky":964,"./ky.js":964,"./lb":965,"./lb.js":965,"./lo":966,"./lo.js":966,"./lt":967,"./lt.js":967,"./lv":968,"./lv.js":968,"./me":969,"./me.js":969,"./mi":970,"./mi.js":970,"./mk":971,"./mk.js":971,"./ml":972,"./ml.js":972,"./mn":973,"./mn.js":973,"./mr":974,"./mr.js":974,"./ms":975,"./ms-my":976,"./ms-my.js":976,"./ms.js":975,"./mt":977,"./mt.js":977,"./my":978,"./my.js":978,"./nb":979,"./nb.js":979,"./ne":980,"./ne.js":980,"./nl":981,"./nl-be":982,"./nl-be.js":982,"./nl.js":981,"./nn":983,"./nn.js":983,"./pa-in":984,"./pa-in.js":984,"./pl":985,"./pl.js":985,"./pt":986,"./pt-br":987,"./pt-br.js":987,"./pt.js":986,"./ro":988,"./ro.js":988,"./ru":989,"./ru.js":989,"./sd":990,"./sd.js":990,"./se":991,"./se.js":991,"./si":992,"./si.js":992,"./sk":993,"./sk.js":993,"./sl":994,"./sl.js":994,"./sq":995,"./sq.js":995,"./sr":996,"./sr-cyrl":997,"./sr-cyrl.js":997,"./sr.js":996,"./ss":998,"./ss.js":998,"./sv":999,"./sv.js":999,"./sw":1e3,"./sw.js":1e3,"./ta":1001,"./ta.js":1001,"./te":1002,"./te.js":1002,"./tet":1003,"./tet.js":1003,"./tg":1004,"./tg.js":1004,"./th":1005,"./th.js":1005,"./tl-ph":1006,"./tl-ph.js":1006,"./tlh":1007,"./tlh.js":1007,"./tr":1008,"./tr.js":1008,"./tzl":1009,"./tzl.js":1009,"./tzm":1010,"./tzm-latn":1011,"./tzm-latn.js":1011,"./tzm.js":1010,"./ug-cn":1012,"./ug-cn.js":1012,"./uk":1013,"./uk.js":1013,"./ur":1014,"./ur.js":1014,"./uz":1015,"./uz-latn":1016,"./uz-latn.js":1016,"./uz.js":1015,"./vi":1017,"./vi.js":1017,"./x-pseudo":1018,"./x-pseudo.js":1018,"./yo":1019,"./yo.js":1019,"./zh-cn":1020,"./zh-cn.js":1020,"./zh-hk":1021,"./zh-hk.js":1021,"./zh-tw":1022,"./zh-tw.js":1022};function a(e){var t=o(e);return n(t)}function o(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=1749},1763:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=p(n(1)),l=p(n(0)),i=n(12),u=p(n(269)),s=p(n(453)),c=p(n(407)),f=p(n(65)),d=p(n(551));function p(e){return e&&e.__esModule?e:{default:e}}var h={fixed:"fix",metric:"metric"},m={onChange:l.default.func,value:l.default.object,isFloat:l.default.bool,datasource:l.default.object,default:l.default.shape({type:l.default.oneOf(["fix","metric"]),value:l.default.oneOfType([l.default.string,l.default.number])})},y={onChange:function(){return function(){}}(),default:{type:h.fixed,value:5}},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.onChange=n.onChange.bind(n),n.setType=n.setType.bind(n),n.setFixedValue=n.setFixedValue.bind(n),n.setMetric=n.setMetric.bind(n);var r=(e.value?e.value.type:e.default.type)||h.fixed,a=(e.value?e.value.value:e.default.value)||"100";return n.state={type:r,fixedValue:r===h.fixed?a:"",metricValue:r===h.metric?a:null},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"onChange",value:function(){return function(){this.props.onChange({type:this.state.type,value:this.state.type===h.fixed?this.state.fixedValue:this.state.metricValue})}}()},{key:"setType",value:function(){return function(e){this.setState({type:e},this.onChange)}}()},{key:"setFixedValue",value:function(){return function(e){this.setState({fixedValue:e},this.onChange)}}()},{key:"setMetric",value:function(){return function(e){this.setState({metricValue:e},this.onChange)}}()},{key:"renderPopover",value:function(){return function(){var e=this,t=(this.props.value||this.props.default).type||h.fixed,n=this.props.datasource?this.props.datasource.metrics_combo:null;return o.default.createElement(i.Popover,{id:"filter-popover"},o.default.createElement("div",{style:{width:"240px"}},o.default.createElement(d.default,{title:"Fixed",isSelected:t===h.fixed,onSelect:function(){e.onChange(h.fixed)}},o.default.createElement(s.default,{isFloat:!0,onChange:this.setFixedValue,onFocus:function(){e.setType(h.fixed)},value:this.state.fixedValue})),o.default.createElement(d.default,{title:"Based on a metric",isSelected:t===h.metric,onSelect:function(){e.onChange(h.metric)}},o.default.createElement(c.default,r({},u.default.metric,{name:"metric",choices:n,onFocus:function(){e.setType(h.metric)},onChange:this.setMetric,value:this.state.metricValue})))))}}()},{key:"render",value:function(){return function(){return o.default.createElement("div",null,o.default.createElement(f.default,this.props),o.default.createElement(i.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},o.default.createElement(i.Label,{style:{cursor:"pointer"}},this.state.type===h.fixed&&o.default.createElement("span",null,this.state.fixedValue),this.state.type===h.metric&&o.default.createElement("span",null,o.default.createElement("span",{style:{fontWeight:"normal"}},"metric: "),o.default.createElement("strong",null,this.state.metricValue)))))}}()}]),t}();t.default=v,v.propTypes=m,v.defaultProps=y},1764:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=l(n(1)),a=l(n(0)),o=n(12);function l(e){return e&&e.__esModule?e:{default:e}}var i={onChange:a.default.func,value:a.default.oneOfType([a.default.string,a.default.number])},u={onChange:function(){return function(){}}()};function s(e){return r.default.createElement(o.FormControl,{type:"hidden",value:e.value})}s.propTypes=i,s.defaultProps=u},1765:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=f(n(1)),o=f(n(0)),l=n(12),i=f(n(75)),u=f(n(66)),s=f(n(884)),c=f(n(550));function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p={onChange:o.default.func},h={onChange:function(){return function(){}}()},m=[{value:"value",label:"Actual value"},{value:"diff",label:"Difference"},{value:"perc",label:"Percentage"},{value:"perc_change",label:"Percentage Change"}],y=[{value:"time",label:"Time Comparison"},{value:"contrib",label:"Contribution"},{value:"spark",label:"Sparkline"},{value:"avg",label:"Period Average"}],v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=Object.assign({},e);return delete r.onChange,n.state=r,n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onChange",value:function(){return function(){this.props.onChange(this.state)}}()},{key:"onSelectChange",value:function(){return function(e,t){this.setState(d({},e,t.value),this.onChange)}}()},{key:"onTextInputChange",value:function(){return function(e,t){this.setState(d({},e,t.target.value),this.onChange)}}()},{key:"onCheckboxChange",value:function(){return function(e,t){this.setState(d({},e,t),this.onChange)}}()},{key:"onBoundsChange",value:function(){return function(e){this.setState({bounds:e},this.onChange)}}()},{key:"onYAxisBoundsChange",value:function(){return function(e){this.setState({yAxisBounds:e},this.onChange)}}()},{key:"setType",value:function(){return function(){}}()},{key:"textSummary",value:function(){return function(){return""+this.state.label}}()},{key:"edit",value:function(){return function(){}}()},{key:"formRow",value:function(){return function(e,t,n,r){return a.default.createElement(l.Row,{style:{marginTop:"5px"}},a.default.createElement(l.Col,{md:5},e+" ",a.default.createElement(u.default,{placement:"top",tooltip:t,label:n})),a.default.createElement(l.Col,{md:7},r))}}()},{key:"renderPopover",value:function(){return function(){return a.default.createElement(l.Popover,{id:"ts-col-popo",title:"Column Configuration"},a.default.createElement("div",{style:{width:300}},this.formRow("Label","The column header label","time-lag",a.default.createElement(l.FormControl,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),bsSize:"small",placeholder:"Label"})),this.formRow("Tooltip","Column header tooltip","col-tooltip",a.default.createElement(l.FormControl,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),bsSize:"small",placeholder:"Tooltip"})),this.formRow("Type","Type of comparison, value difference or percentage","col-type",a.default.createElement(i.default,{value:this.state.colType,clearable:!1,onChange:this.onSelectChange.bind(this,"colType"),options:y})),a.default.createElement("hr",null),"spark"===this.state.colType&&this.formRow("Width","Width of the sparkline","spark-width",a.default.createElement(l.FormControl,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),bsSize:"small",placeholder:"Width"})),"spark"===this.state.colType&&this.formRow("Height","Height of the sparkline","spark-width",a.default.createElement(l.FormControl,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),bsSize:"small",placeholder:"height"})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow("Time Lag","Number of periods to compare against","time-lag",a.default.createElement(l.FormControl,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),bsSize:"small",placeholder:"Time Lag"})),["spark"].indexOf(this.state.colType)>=0&&this.formRow("Time Ratio","Number of periods to ratio against","time-ratio",a.default.createElement(l.FormControl,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),bsSize:"small",placeholder:"Time Lag"})),"time"===this.state.colType&&this.formRow("Type","Type of comparison, value difference or percentage","comp-type",a.default.createElement(i.default,{value:this.state.comparisonType,clearable:!1,onChange:this.onSelectChange.bind(this,"comparisonType"),options:m})),"spark"===this.state.colType&&this.formRow("Show Y-axis","Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.","show-y-axis-bounds",a.default.createElement(c.default,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow("Y-axis bounds","Manually set min/max values for the y-axis.","y-axis-bounds",a.default.createElement(s.default,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow("Color bounds","Number bounds used for color encoding from red to blue.\n              Reverse the numbers for blue to red. To get pure red or blue,\n              you can enter either only min or max.","bounds",a.default.createElement(s.default,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow("Number format","Optional d3 number format string","d3-format",a.default.createElement(l.FormControl,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),bsSize:"small",placeholder:"Number format string"})),"spark"===this.state.colType&&this.formRow("Date format","Optional d3 date format string","date-format",a.default.createElement(l.FormControl,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),bsSize:"small",placeholder:"Date format string"}))))}}()},{key:"render",value:function(){return function(){return a.default.createElement("span",null,this.textSummary()," ",a.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},a.default.createElement(u.default,{icon:"edit",className:"text-primary",onClick:this.edit.bind(this),label:"edit-ts-column"})))}}()}]),t}();t.default=v,v.propTypes=p,v.defaultProps=h},1766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=f(n(1)),o=f(n(0)),l=n(12),i=n(1767),u=f(n(453)),s=f(n(65)),c=n(409);function f(e){return e&&e.__esModule?e:{default:e}}var d=["longitude","latitude","zoom","bearing","pitch"],p={onChange:o.default.func.isRequired,value:o.default.shape({longitude:o.default.number,latitude:o.default.number,zoom:o.default.number,bearing:o.default.number,pitch:o.default.number}),default:o.default.object,name:o.default.string.isRequired},h={onChange:function(){return function(){}}(),default:{type:"fix",value:5},value:c.defaultViewport},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onChange",value:function(){return function(e,t){this.props.onChange(Object.assign({},this.props.value,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t)))}}()},{key:"renderTextControl",value:function(){return function(e){return a.default.createElement("div",{key:e},e,a.default.createElement(u.default,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}}()},{key:"renderPopover",value:function(){return function(){var e=this;return a.default.createElement(l.Popover,{id:"filter-popover-"+this.props.name,title:"Viewport"},d.map(function(t){return e.renderTextControl(t)}))}}()},{key:"renderLabel",value:function(){return function(){return this.props.value.longitude&&this.props.value.latitude?(0,i.decimal2sexagesimal)(this.props.value.longitude)+" | "+(0,i.decimal2sexagesimal)(this.props.value.latitude):"N/A"}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement(s.default,this.props),a.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},a.default.createElement(l.Label,{style:{cursor:"pointer"}},this.renderLabel())))}}()}]),t}();t.default=m,m.propTypes=p,m.defaultProps=h},1768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=c(n(1)),o=c(n(0)),l=n(12),i=c(n(268)),u=c(n(65)),s=n(11);function c(e){return e&&e.__esModule?e:{default:e}}var f={description:o.default.string,label:o.default.string,name:o.default.string.isRequired,onChange:o.default.func,value:o.default.string.isRequired},d={onChange:function(){return function(){}}()},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showModal:!1,filter:""},n.toggleModal=n.toggleModal.bind(n),n.changeSearch=n.changeSearch.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.focusSearch=n.focusSearch.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(e){this.props.onChange(e),this.setState({showModal:!1})}}()},{key:"setSearchRef",value:function(){return function(e){this.searchRef=e}}()},{key:"toggleModal",value:function(){return function(){this.setState({showModal:!this.state.showModal})}}()},{key:"changeSearch",value:function(){return function(e){this.setState({filter:e.target.value})}}()},{key:"focusSearch",value:function(){return function(){this.searchRef&&this.searchRef.focus()}}()},{key:"renderVizType",value:function(){return function(e){var t=e;return a.default.createElement("div",{className:"viztype-selector-container "+(t===this.props.value?"selected":""),onClick:this.onChange.bind(this,t)},a.default.createElement("img",{alt:"viz-type-"+t,width:"100%",className:"viztype-selector "+(this.props.value===t?"selected":""),src:"/static/assets/images/viz_thumbnails/"+t+".png"}),a.default.createElement("div",{className:"viztype-label"},i.default[t].label))}}()},{key:"render",value:function(){return function(){for(var e=this,t=this.state.filter,n=Object.keys(i.default).filter(function(e){return 0===t.length||i.default[e].label.toLowerCase().includes(t)}),r=[],o=0;o<=n.length;o+=6)r.push(a.default.createElement(l.Row,{key:"row-"+o},n.slice(o,o+6).map(function(t){return a.default.createElement(l.Col,{md:2,key:"grid-col-"+t},e.renderVizType(t))})));return a.default.createElement("div",null,a.default.createElement(u.default,this.props),a.default.createElement(l.OverlayTrigger,{placement:"right",overlay:a.default.createElement(l.Tooltip,{id:"error-tooltip"},"Click to change visualization type")},a.default.createElement(l.Label,{onClick:this.toggleModal,style:{cursor:"pointer"}},i.default[this.props.value].label)),a.default.createElement(l.Modal,{show:this.state.showModal,onHide:this.toggleModal,onEnter:this.focusSearch,onExit:this.setSearchRef,bsSize:"lg"},a.default.createElement(l.Modal.Header,{closeButton:!0},a.default.createElement(l.Modal.Title,null,(0,s.t)("Select a visualization type"))),a.default.createElement(l.Modal.Body,null,a.default.createElement("div",null,a.default.createElement(l.FormControl,{id:"formControlsText",inputRef:function(t){e.setSearchRef(t)},type:"text",bsSize:"sm",value:this.state.filter,placeholder:(0,s.t)("Search / Filter"),onChange:this.changeSearch})),r)))}}()}]),t}();t.default=p,p.propTypes=f,p.defaultProps=d},1769:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=g(n(1)),o=g(n(0)),l=g(n(266)),i=g(n(65)),u=n(11),s=g(n(396)),c=g(n(397)),f=g(n(1770)),d=g(n(1772)),p=g(n(358)),h=g(n(229)),m=g(n(553)),y=g(n(291)),v=n(292);function g(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var E={name:o.default.string.isRequired,onChange:o.default.func,value:o.default.oneOfType([o.default.arrayOf(o.default.oneOfType([o.default.string,y.default])),o.default.oneOfType([o.default.string,y.default])]),columns:o.default.arrayOf(h.default),savedMetrics:o.default.arrayOf(m.default),multi:o.default.bool,datasourceType:o.default.string},C={onChange:function(){return function(){}}()};function O(e){return e&&!(e instanceof p.default)&&e.expressionType}function _(e){return e?Array.isArray(e)?e.map(function(e){return O(e)?new p.default(e):e}):O(e)?[new p.default(e)]:[e]:[]}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n.onMetricEdit=n.onMetricEdit.bind(n),n.checkIfAggregateInInput=n.checkIfAggregateInInput.bind(n),n.optionsForSelect=n.optionsForSelect.bind(n),n.selectFilterOption=n.selectFilterOption.bind(n),n.isAutoGeneratedMetric=n.isAutoGeneratedMetric.bind(n),n.optionRenderer=(0,s.default)(function(e){return a.default.createElement(f.default,{option:e})},{ignoreAutogeneratedMetrics:!0}),n.valueRenderer=function(e){return a.default.createElement(d.default,{option:e,onMetricEdit:n.onMetricEdit,columns:n.props.columns,multi:n.props.multi,datasourceType:n.props.datasourceType})},n.refFunc=function(e){e&&(n.select=e._selectRef)},n.state={aggregateInInput:null,options:n.optionsForSelect(n.props),value:_(n.props.value)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"componentWillReceiveProps",value:function(){return function(e){this.props.columns===e.columns&&this.props.savedMetrics===e.savedMetrics||(this.setState({options:this.optionsForSelect(e)}),this.props.onChange([])),this.props.value!==e.value&&this.setState({value:_(e.value)})}}()},{key:"onMetricEdit",value:function(){return function(e){var t=this.state.value.map(function(t){return t.optionName===e.optionName?e:t});this.props.multi||(t=t[0]),this.props.onChange(t)}}()},{key:"onChange",value:function(){return function(e){var t=this;if(null!==e){var n=e;this.props.multi||(n=[e].filter(function(e){return e}));var r=n.map(function(e){if(e.metric_name)return e.metric_name;if(e.column_name){var n=t.clearedAggregateInInput;return t.clearedAggregateInInput=null,new p.default({column:e,aggregate:n||function(e){var t=e.type;return"string"!=typeof t?v.AGGREGATES.COUNT:""===t||"expression"===t?v.AGGREGATES.SUM:t.match(/.*char.*/i)||t.match(/string.*/i)||t.match(/.*text.*/i)?v.AGGREGATES.COUNT_DISTINCT:t.match(/.*int.*/i)||"LONG"===t||"DOUBLE"===t||"FLOAT"===t?v.AGGREGATES.SUM:t.match(/.*bool.*/i)?v.AGGREGATES.MAX:t.match(/.*time.*/i)?v.AGGREGATES.COUNT:t.match(/unknown/i)?v.AGGREGATES.COUNT:null}(e)})}if(e instanceof p.default)return e;if(e.aggregate_name){var r=e.aggregate_name+"()";return t.select.setInputValue(r),t.select.handleInputChange({target:{value:r}}),setTimeout(function(){t.select.input.input.selectionStart=r.length-1,t.select.input.input.selectionEnd=r.length-1},0),null}return null}).filter(function(e){return e});this.props.multi||(r=r[0]),this.props.onChange(r)}else this.props.onChange(null)}}()},{key:"checkIfAggregateInInput",value:function(){return function(e){var t={aggregateInInput:null};Object.keys(v.AGGREGATES).forEach(function(n){e.toLowerCase().startsWith(n.toLowerCase()+"(")&&(t={aggregateInInput:n})}),this.clearedAggregateInInput=this.state.aggregateInInput,this.setState(t)}}()},{key:"optionsForSelect",value:function(){return function(e){return[].concat(b(e.columns),b(Object.keys(v.AGGREGATES).map(function(e){return{aggregate_name:e}})),b(e.savedMetrics)).reduce(function(e,t){return t.metric_name?e.push(Object.assign({},t,{optionName:t.metric_name})):t.column_name?e.push(Object.assign({},t,{optionName:"_col_"+t.column_name})):t.aggregate_name&&e.push(Object.assign({},t,{optionName:"_aggregate_"+t.aggregate_name})),e},[])}}()},{key:"isAutoGeneratedMetric",value:function(){return function(e){return"druid"===this.props.datasourceType?v.druidAutoGeneratedMetricRegex.test(e.verbose_name):v.sqlaAutoGeneratedMetricNameRegex.test(e.metric_name)}}()},{key:"selectFilterOption",value:function(){return function(e,t){if(this.state.aggregateInInput){var n=t.length;t.endsWith(")")&&(n=t.length-1);var r=t.substring(t.indexOf("(")+1,n);return e.column_name&&e.column_name.toLowerCase().indexOf(r)>=0}return e.optionName&&(!e.metric_name||!this.isAutoGeneratedMetric(e)||e.verbose_name)&&(e.optionName.toLowerCase().indexOf(t)>=0||e.verbose_name&&e.verbose_name.toLowerCase().indexOf(t)>=0)}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",{className:"metrics-select"},a.default.createElement(i.default,this.props),a.default.createElement(c.default,{multi:this.props.multi,name:"select-"+this.props.name,placeholder:(0,u.t)("choose a column or aggregate function"),options:this.state.options,value:this.props.multi?this.state.value:this.state.value[0],labelKey:"label",valueKey:"optionName",clearable:!0,closeOnSelect:!0,onChange:this.onChange,optionRenderer:this.optionRenderer,valueRenderer:this.valueRenderer,onInputChange:this.checkIfAggregateInInput,filterOption:this.selectFilterOption,refFunc:this.refFunc,selectWrap:l.default}))}}()}]),t}();t.default=S,S.propTypes=E,S.defaultProps=C},1770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(1)),a=d(n(0)),o=d(n(609)),l=d(n(294)),i=d(n(1771)),u=d(n(229)),s=d(n(553)),c=d(n(1023)),f=d(n(322));function d(e){return e&&e.__esModule?e:{default:e}}var p={option:a.default.oneOfType([u.default,s.default,c.default]).isRequired,addWarningToast:a.default.func.isRequired};function h(e){var t=e.option,n=e.addWarningToast;return t.metric_name?r.default.createElement(o.default,{metric:t,showType:!0}):t.column_name?r.default.createElement(l.default,{column:t,showType:!0}):t.aggregate_name?r.default.createElement(i.default,{aggregate:t,showType:!0}):(n("You must supply either a saved metric, column or aggregate to MetricDefinitionOption"),null)}h.propTypes=p,t.default=(0,f.default)(h)},1771:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=l(n(1)),a=l(n(0)),o=l(n(293));function l(e){return e&&e.__esModule?e:{default:e}}var i={aggregate:l(n(1023)).default,showType:a.default.bool};function u(e){var t=e.aggregate,n=e.showType;return r.default.createElement("div",null,n&&r.default.createElement(o.default,{type:"aggregate"}),r.default.createElement("span",{className:"m-r-5 option-label"},t.aggregate_name))}u.propTypes=i},1772:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var r=f(n(1)),a=f(n(0)),o=f(n(1773)),l=f(n(358)),i=f(n(229)),u=f(n(609)),s=f(n(553)),c=f(n(291));function f(e){return e&&e.__esModule?e:{default:e}}var d={option:a.default.oneOfType([s.default,c.default]).isRequired,onMetricEdit:a.default.func,columns:a.default.arrayOf(i.default),multi:a.default.bool,datasourceType:a.default.string};function p(e){var t=e.option,n=e.onMetricEdit,a=e.columns,i=e.multi,s=e.datasourceType;return t.metric_name?r.default.createElement(u.default,{metric:t}):t instanceof l.default?r.default.createElement(o.default,{adhocMetric:t,onMetricEdit:n,columns:a,multi:i,datasourceType:s}):null}p.propTypes=d},1773:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=c(n(1)),o=c(n(0)),l=n(12),i=c(n(1774)),u=c(n(358)),s=c(n(229));function c(e){return e&&e.__esModule?e:{default:e}}var f={adhocMetric:o.default.instanceOf(u.default),onMetricEdit:o.default.func.isRequired,columns:o.default.arrayOf(s.default),multi:o.default.bool,datasourceType:o.default.string},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeMetricEditOverlay=n.closeMetricEditOverlay.bind(n),n.onOverlayEntered=n.onOverlayEntered.bind(n),n.onOverlayExited=n.onOverlayExited.bind(n),n.onPopoverResize=n.onPopoverResize.bind(n),n.state={overlayShown:!n.props.adhocMetric.fromFormData},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onPopoverResize",value:function(){return function(){this.forceUpdate()}}()},{key:"onOverlayEntered",value:function(){return function(){this.setState({overlayShown:!0})}}()},{key:"onOverlayExited",value:function(){return function(){this.setState({overlayShown:!1})}}()},{key:"closeMetricEditOverlay",value:function(){return function(){this.refs.overlay.hide()}}()},{key:"render",value:function(){return function(){var e=this.props.adhocMetric,t=a.default.createElement(i.default,{onResize:this.onPopoverResize,adhocMetric:e,onChange:this.props.onMetricEdit,onClose:this.closeMetricEditOverlay,columns:this.props.columns,datasourceType:this.props.datasourceType});return a.default.createElement(l.OverlayTrigger,{ref:"overlay",placement:"right",trigger:"click",disabled:!0,overlay:t,rootClose:!0,shouldUpdatePosition:!0,defaultOverlayShown:!e.fromFormData,onEntered:this.onOverlayEntered,onExited:this.onOverlayExited},a.default.createElement(l.Label,{style:{margin:this.props.multi?0:3,cursor:"pointer"}},a.default.createElement("div",{onMouseDownCapture:function(e){e.stopPropagation()}},a.default.createElement("span",{className:"m-r-5 option-label"},e.label,a.default.createElement("i",{className:"glyphicon glyphicon-triangle-"+(this.state.overlayShown?"left":"right")+" adhoc-label-arrow"})))))}}()}]),t}();t.default=d,d.propTypes=f},1774:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=E(n(1)),l=E(n(0)),i=n(12),u=E(n(266)),s=E(n(267));n(359),n(360),n(457);var c=n(292),f=n(11),d=E(n(396)),p=E(n(397)),h=E(n(1775)),m=E(n(229)),y=n(358),v=E(y),g=E(n(294)),b=n(556);function E(e){return e&&e.__esModule?e:{default:e}}var C=ace.acequire("ace/ext/language_tools"),O={adhocMetric:l.default.instanceOf(v.default).isRequired,onChange:l.default.func.isRequired,onClose:l.default.func.isRequired,onResize:l.default.func.isRequired,columns:l.default.arrayOf(m.default),datasourceType:l.default.string},_=300,S=180,T=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.onSave=n.onSave.bind(n),n.onColumnChange=n.onColumnChange.bind(n),n.onAggregateChange=n.onAggregateChange.bind(n),n.onSqlExpressionChange=n.onSqlExpressionChange.bind(n),n.onLabelChange=n.onLabelChange.bind(n),n.onDragDown=n.onDragDown.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.handleAceEditorRef=n.handleAceEditorRef.bind(n),n.refreshAceEditor=n.refreshAceEditor.bind(n),n.state={adhocMetric:n.props.adhocMetric,width:_,height:S},n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!0,selectWrap:u.default},C){var r=b.sqlWords.concat(n.props.columns.map(function(e){return{name:e.column_name,value:e.column_name,score:50,meta:"column"}})),a={getCompletions:function(){return function(e,t,n,a,o){o(null,r)}}()};C.setCompleters([a])}return document.addEventListener("mouseup",n.onMouseUp),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"componentWillUnmount",value:function(){return function(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}}()},{key:"onSave",value:function(){return function(){this.props.onChange(this.state.adhocMetric),this.props.onClose()}}()},{key:"onColumnChange",value:function(){return function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({column:e,expressionType:y.EXPRESSION_TYPES.SIMPLE})})}}()},{key:"onAggregateChange",value:function(){return function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({aggregate:e&&e.aggregate,expressionType:y.EXPRESSION_TYPES.SIMPLE})})}}()},{key:"onSqlExpressionChange",value:function(){return function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({sqlExpression:e,expressionType:y.EXPRESSION_TYPES.SQL})})}}()},{key:"onLabelChange",value:function(){return function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({label:e.target.value,hasCustomLabel:!0})})}}()},{key:"onDragDown",value:function(){return function(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}}()},{key:"onMouseMove",value:function(){return function(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),_),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),S)})}}()},{key:"onMouseUp",value:function(){return function(){document.removeEventListener("mousemove",this.onMouseMove)}}()},{key:"handleAceEditorRef",value:function(){return function(e){e&&(this.aceEditorRef=e)}}()},{key:"refreshAceEditor",value:function(){return function(){var e=this;setTimeout(function(){return e.aceEditorRef.editor.resize()},0)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.adhocMetric,n=e.columns,a=(e.onChange,e.onClose,e.onResize,e.datasourceType,function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["adhocMetric","columns","onChange","onClose","onResize","datasourceType"])),l=this.state.adhocMetric,u={placeholder:(0,f.t)("%s column(s)",n.length),options:n,value:l.column&&l.column.column_name||l.inferSqlExpressionColumn(),onChange:this.onColumnChange,optionRenderer:(0,d.default)(function(e){return o.default.createElement(g.default,{column:e,showType:!0})}),valueRenderer:function(e){return e.column_name},valueKey:"column_name"},m={placeholder:(0,f.t)("%s aggregates(s)",Object.keys(c.AGGREGATES).length),options:Object.keys(c.AGGREGATES).map(function(e){return{aggregate:e}}),value:l.aggregate||l.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,optionRenderer:(0,d.default)(function(e){return e.aggregate}),valueRenderer:function(e){return e.aggregate},valueKey:"aggregate"};"druid"===this.props.datasourceType&&(m.options=m.options.filter(function(e){return"AVG"!==e.aggregate}));var v=o.default.createElement(h.default,{adhocMetric:l,onChange:this.onLabelChange}),b=l.isValid(),E=!l.equals(t);return o.default.createElement(i.Popover,r({id:"metrics-edit-popover",title:v},a),o.default.createElement(i.Tabs,{id:"adhoc-metric-edit-tabs",defaultActiveKey:l.expressionType,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onSelect:this.refreshAceEditor,animation:!1},o.default.createElement(i.Tab,{className:"adhoc-metric-edit-tab",eventKey:y.EXPRESSION_TYPES.SIMPLE,title:"Simple"},o.default.createElement(i.FormGroup,null,o.default.createElement(i.ControlLabel,null,o.default.createElement("strong",null,"column")),o.default.createElement(p.default,r({},this.selectProps,u))),o.default.createElement(i.FormGroup,null,o.default.createElement(i.ControlLabel,null,o.default.createElement("strong",null,"aggregate")),o.default.createElement(p.default,r({},this.selectProps,m)))),o.default.createElement(i.Tab,{className:"adhoc-metric-edit-tab",eventKey:y.EXPRESSION_TYPES.SQL,title:"Custom SQL"},"druid"!==this.props.datasourceType?o.default.createElement(i.FormGroup,null,o.default.createElement(s.default,{ref:this.handleAceEditorRef,mode:"sql",theme:"github",height:this.state.height-43+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:l.sqlExpression||l.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"adhoc-filter-sql-editor",wrapEnabled:!0})):o.default.createElement("div",{className:"custom-sql-disabled-message"},"Custom SQL Metrics are not available on druid datasources"))),o.default.createElement("div",null,o.default.createElement(i.Button,{disabled:!b,bsStyle:E&&b?"primary":"default",bsSize:"small",className:"m-r-5",onClick:this.onSave},"Save"),o.default.createElement(i.Button,{bsSize:"small",onClick:this.props.onClose},"Close"),o.default.createElement("i",{onMouseDown:this.onDragDown,className:"glyphicon glyphicon-resize-full edit-popover-resize"})))}}()}]),t}();t.default=T,T.propTypes=O,T.defaultProps={columns:[]}},1775:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=u(n(1)),o=u(n(0)),l=n(12),i=u(n(358));function u(e){return e&&e.__esModule?e:{default:e}}var s={adhocMetric:o.default.instanceOf(i.default),onChange:o.default.func.isRequired},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMouseOver=n.onMouseOver.bind(n),n.onMouseOut=n.onMouseOut.bind(n),n.onClick=n.onClick.bind(n),n.onBlur=n.onBlur.bind(n),n.state={isHovered:!1,isEditable:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onMouseOver",value:function(){return function(){this.setState({isHovered:!0})}}()},{key:"onMouseOut",value:function(){return function(){this.setState({isHovered:!1})}}()},{key:"onClick",value:function(){return function(){this.setState({isEditable:!0})}}()},{key:"onBlur",value:function(){return function(){this.setState({isEditable:!1})}}()},{key:"refFunc",value:function(){return function(e){e&&e.focus()}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.adhocMetric,n=e.onChange,r=a.default.createElement(l.Tooltip,{id:"edit-metric-label-tooltip"},"Click to edit label");return a.default.createElement(l.OverlayTrigger,{placement:"top",overlay:r,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onClick:this.onClick,onBlur:this.onBlur},this.state.isEditable?a.default.createElement(l.FormControl,{className:"metric-edit-popover-label-input",type:"text",placeholder:t.label,value:t.hasCustomLabel?t.label:"",onChange:n,inputRef:this.refFunc}):a.default.createElement("span",null,t.hasCustomLabel?t.label:"My Metric"," ",a.default.createElement("i",{className:"fa fa-pencil",style:{color:this.state.isHovered?"black":"grey"}})))}}()}]),t}();t.default=c,c.propTypes=s},1776:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=C(n(1)),o=C(n(0)),l=C(n(266)),i=n(11),u=C(n(65)),s=C(n(1777)),c=C(n(291)),f=C(n(553)),d=C(n(229)),p=n(408),h=C(p),m=C(n(358)),y=n(292),v=C(n(396)),g=C(n(397)),b=C(n(1778)),E=C(n(1024));function C(e){return e&&e.__esModule?e:{default:e}}function O(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _={name:o.default.string,onChange:o.default.func,value:o.default.arrayOf(s.default),datasource:o.default.object,columns:o.default.arrayOf(d.default),savedMetrics:o.default.arrayOf(f.default),formData:o.default.shape({metric:o.default.oneOfType([o.default.string,c.default]),metrics:o.default.arrayOf(o.default.oneOfType([o.default.string,c.default]))})},S={name:"",onChange:function(){return function(){}}(),columns:[],savedMetrics:[],formData:{}};function T(e){return e&&!(e instanceof h.default)&&e.expressionType}var w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.optionsForSelect=n.optionsForSelect.bind(n),n.onFilterEdit=n.onFilterEdit.bind(n),n.onChange=n.onChange.bind(n),n.getMetricExpression=n.getMetricExpression.bind(n);var r=(n.props.value||[]).map(function(e){return T(e)?new h.default(e):e});return n.optionRenderer=(0,v.default)(function(e){return a.default.createElement(E.default,{option:e})}),n.valueRenderer=function(e){return a.default.createElement(b.default,{adhocFilter:e,onFilterEdit:n.onFilterEdit,options:n.state.options,datasource:n.props.datasource})},n.state={values:r,options:n.optionsForSelect(n.props)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"componentWillReceiveProps",value:function(){return function(e){this.props.columns===e.columns&&this.props.formData===e.formData||this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map(function(e){return T(e)?new h.default(e):e})})}}()},{key:"onFilterEdit",value:function(){return function(e){this.props.onChange(this.state.values.map(function(t){return t.filterOptionName===e.filterOptionName?e:t}))}}()},{key:"onChange",value:function(){return function(e){var t=this;this.props.onChange(e.map(function(e){return e.saved_metric_name?new h.default({expressionType:"druid"===t.props.datasource.type?p.EXPRESSION_TYPES.SIMPLE:p.EXPRESSION_TYPES.SQL,subject:"druid"===t.props.datasource.type?e.saved_metric_name:t.getMetricExpression(e.saved_metric_name),operator:y.OPERATORS[">"],comparator:0,clause:p.CLAUSES.HAVING}):e.label?new h.default({expressionType:"druid"===t.props.datasource.type?p.EXPRESSION_TYPES.SIMPLE:p.EXPRESSION_TYPES.SQL,subject:"druid"===t.props.datasource.type?e.label:new m.default(e).translateToSql(),operator:y.OPERATORS[">"],comparator:0,clause:p.CLAUSES.HAVING}):e.column_name?new h.default({expressionType:p.EXPRESSION_TYPES.SIMPLE,subject:e.column_name,operator:y.OPERATORS["=="],comparator:"",clause:p.CLAUSES.WHERE}):e instanceof h.default?e:null}).filter(function(e){return e}))}}()},{key:"getMetricExpression",value:function(){return function(e){return this.props.savedMetrics.find(function(t){return t.metric_name===e}).expression}}()},{key:"optionsForSelect",value:function(){return function(e){return[].concat(O(e.columns),O([].concat(O(e.formData.metrics||[]),[e.formData.metric]).map(function(e){return e&&("string"==typeof e?{saved_metric_name:e}:new m.default(e))}))).filter(function(e){return e}).reduce(function(e,t){return t.saved_metric_name?e.push(Object.assign({},t,{filterOptionName:t.saved_metric_name})):t.column_name?e.push(Object.assign({},t,{filterOptionName:"_col_"+t.column_name})):t instanceof m.default&&e.push(Object.assign({},t,{filterOptionName:"_adhocmetric_"+t.label})),e},[]).sort(function(e,t){return(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)})}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",{className:"metrics-select"},a.default.createElement(u.default,this.props),a.default.createElement(g.default,{multi:!0,name:"select-"+this.props.name,placeholder:(0,i.t)("choose a column or metric"),options:this.state.options,value:this.state.values,labelKey:"label",valueKey:"filterOptionName",clearable:!0,closeOnSelect:!0,onChange:this.onChange,optionRenderer:this.optionRenderer,valueRenderer:this.valueRenderer,selectWrap:l.default}))}}()}]),t}();t.default=w,w.propTypes=_,w.defaultProps=S},1777:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(292),o=n(408);t.default=r.default.oneOfType([r.default.shape({expressionType:r.default.oneOf([o.EXPRESSION_TYPES.SIMPLE]).isRequired,clause:r.default.oneOf([o.CLAUSES.HAVING,o.CLAUSES.WHERE]).isRequired,subject:r.default.string.isRequired,operator:r.default.oneOf(Object.keys(a.OPERATORS)).isRequired,comparator:r.default.oneOfType([r.default.string,r.default.arrayOf(r.default.string)]).isRequired}),r.default.shape({expressionType:r.default.oneOf([o.EXPRESSION_TYPES.SQL]).isRequired,clause:r.default.oneOf([o.CLAUSES.WHERE,o.CLAUSES.HAVING]).isRequired,sqlExpression:r.default.string.isRequired})])},1778:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=f(n(1)),o=f(n(0)),l=n(12),i=f(n(1779)),u=f(n(408)),s=f(n(229)),c=f(n(291));function f(e){return e&&e.__esModule?e:{default:e}}var d={adhocFilter:o.default.instanceOf(u.default).isRequired,onFilterEdit:o.default.func.isRequired,options:o.default.arrayOf(o.default.oneOfType([s.default,o.default.shape({saved_metric_name:o.default.string.isRequired}),c.default])).isRequired,datasource:o.default.object},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeFilterEditOverlay=n.closeFilterEditOverlay.bind(n),n.onPopoverResize=n.onPopoverResize.bind(n),n.onOverlayEntered=n.onOverlayEntered.bind(n),n.onOverlayExited=n.onOverlayExited.bind(n),n.state={overlayShown:!n.props.adhocFilter.fromFormData},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onPopoverResize",value:function(){return function(){this.forceUpdate()}}()},{key:"onOverlayEntered",value:function(){return function(){this.setState({overlayShown:!0})}}()},{key:"onOverlayExited",value:function(){return function(){this.setState({overlayShown:!1})}}()},{key:"onMouseDown",value:function(){return function(e){e.stopPropagation()}}()},{key:"closeFilterEditOverlay",value:function(){return function(){this.refs.overlay.hide()}}()},{key:"render",value:function(){return function(){var e=this.props.adhocFilter,t=a.default.createElement(i.default,{onResize:this.onPopoverResize,adhocFilter:e,onChange:this.props.onFilterEdit,onClose:this.closeFilterEditOverlay,options:this.props.options,datasource:this.props.datasource});return a.default.createElement(l.OverlayTrigger,{ref:"overlay",placement:"right",trigger:"click",disabled:!0,overlay:t,rootClose:!0,shouldUpdatePosition:!0,defaultOverlayShown:!e.fromFormData,onEntered:this.onOverlayEntered,onExited:this.onOverlayExited},a.default.createElement(l.Label,{className:"adhoc-filter-option"},a.default.createElement("div",{onMouseDownCapture:this.onMouseDown},a.default.createElement("span",{className:"m-r-5 option-label"},e.getDefaultLabel(),a.default.createElement("i",{className:"glyphicon glyphicon-triangle-"+(this.state.overlayShown?"left":"right")+" adhoc-label-arrow"})))))}}()}]),t}();t.default=p,p.propTypes=d},1779:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=h(n(1)),l=h(n(0)),i=n(12),u=h(n(229)),s=h(n(291)),c=n(408),f=h(c),d=h(n(1780)),p=h(n(1782));function h(e){return e&&e.__esModule?e:{default:e}}var m={adhocFilter:l.default.instanceOf(f.default).isRequired,onChange:l.default.func.isRequired,onClose:l.default.func.isRequired,onResize:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([u.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),s.default])).isRequired,datasource:l.default.object},y=300,v=190,g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSave=n.onSave.bind(n),n.onDragDown=n.onDragDown.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.onAdhocFilterChange=n.onAdhocFilterChange.bind(n),n.adjustHeight=n.adjustHeight.bind(n),n.state={adhocFilter:n.props.adhocFilter,width:y,height:v},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"componentDidMount",value:function(){return function(){document.addEventListener("mouseup",this.onMouseUp)}}()},{key:"componentWillUnmount",value:function(){return function(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}}()},{key:"onAdhocFilterChange",value:function(){return function(e){this.setState({adhocFilter:e})}}()},{key:"onSave",value:function(){return function(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}}()},{key:"onDragDown",value:function(){return function(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}}()},{key:"onMouseMove",value:function(){return function(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),y),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),v)})}}()},{key:"onMouseUp",value:function(){return function(){document.removeEventListener("mousemove",this.onMouseMove)}}()},{key:"adjustHeight",value:function(){return function(e){this.setState(function(t){return{height:t.height+e}})}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.adhocFilter,n=(e.options,e.onChange,e.onClose,e.onResize,e.datasource,function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["adhocFilter","options","onChange","onClose","onResize","datasource"])),a=this.state.adhocFilter,l=a.isValid(),u=!a.equals(t);return o.default.createElement(i.Popover,r({id:"filter-edit-popover"},n),o.default.createElement(i.Tabs,{id:"adhoc-filter-edit-tabs",defaultActiveKey:a.expressionType,className:"adhoc-filter-edit-tabs",style:{height:this.state.height,width:this.state.width}},o.default.createElement(i.Tab,{className:"adhoc-filter-edit-tab",eventKey:c.EXPRESSION_TYPES.SIMPLE,title:"Simple"},o.default.createElement(d.default,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,datasource:this.props.datasource,onHeightChange:this.adjustHeight})),o.default.createElement(i.Tab,{className:"adhoc-filter-edit-tab",eventKey:c.EXPRESSION_TYPES.SQL,title:"Custom SQL"},this.props.datasource&&"druid"===this.props.datasource.type?o.default.createElement("div",{className:"custom-sql-disabled-message"},"Custom SQL Filters are not available on druid datasources"):o.default.createElement(p.default,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height}))),o.default.createElement("div",null,o.default.createElement(i.Button,{disabled:!l,bsStyle:u&&l?"primary":"default",bsSize:"small",className:"m-r-5",onClick:this.onSave},"Save"),o.default.createElement(i.Button,{bsSize:"small",onClick:this.props.onClose},"Close"),o.default.createElement("i",{onMouseDown:this.onDragDown,className:"glyphicon glyphicon-resize-full edit-popover-resize"})))}}()}]),t}();t.default=g,g.propTypes=m},1780:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=b(n(1)),l=b(n(0)),i=n(12),u=b(n(266)),s=n(408),c=b(s),f=b(n(291)),d=b(n(229)),p=n(11),h=n(292),m=b(n(1024)),y=b(n(397)),v=b(n(407)),g=b(n(396));function b(e){return e&&e.__esModule?e:{default:e}}var E=n(22),C={adhocFilter:l.default.instanceOf(c.default).isRequired,onChange:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([d.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),f.default])).isRequired,onHeightChange:l.default.func.isRequired,datasource:l.default.object};function O(e){return e===h.OPERATORS["=="]?"equals":e===h.OPERATORS["!="]?"not equal to":e===h.OPERATORS.LIKE?"like":e}var _=30,S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSubjectChange=n.onSubjectChange.bind(n),n.onOperatorChange=n.onOperatorChange.bind(n),n.onComparatorChange=n.onComparatorChange.bind(n),n.onInputComparatorChange=n.onInputComparatorChange.bind(n),n.isOperatorRelevant=n.isOperatorRelevant.bind(n),n.refreshComparatorSuggestions=n.refreshComparatorSuggestions.bind(n),n.multiComparatorRef=n.multiComparatorRef.bind(n),n.state={suggestions:[],multiComparatorHeight:_},n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!1,selectWrap:u.default},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"componentWillMount",value:function(){return function(){this.refreshComparatorSuggestions()}}()},{key:"componentDidMount",value:function(){return function(){this.handleMultiComparatorInputHeightChange()}}()},{key:"componentDidUpdate",value:function(){return function(e){e.adhocFilter.subject!==this.props.adhocFilter.subject&&this.refreshComparatorSuggestions(),this.handleMultiComparatorInputHeightChange()}}()},{key:"onSubjectChange",value:function(){return function(e){var t=void 0,n=void 0;e&&e.column_name?(t=e.column_name,n=s.CLAUSES.WHERE):e&&(e.saved_metric_name||e.label)&&(t=e.saved_metric_name||e.label,n=s.CLAUSES.HAVING),this.props.onChange(this.props.adhocFilter.duplicateWith({subject:t,clause:n,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}}()},{key:"onOperatorChange",value:function(){return function(e){var t=this.props.adhocFilter.comparator,n=void 0;n=h.MULTI_OPERATORS.indexOf(e.operator)>=0?Array.isArray(t)?t:[t].filter(function(e){return e}):Array.isArray(t)?t[0]:t,this.props.onChange(this.props.adhocFilter.duplicateWith({operator:e&&e.operator,comparator:n,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}}()},{key:"onInputComparatorChange",value:function(){return function(e){this.onComparatorChange(e.target.value)}}()},{key:"onComparatorChange",value:function(){return function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({comparator:e,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}}()},{key:"handleMultiComparatorInputHeightChange",value:function(){return function(){if(this.multiComparatorComponent){var e=this.multiComparatorComponent._selectRef&&this.multiComparatorComponent._selectRef.select&&this.multiComparatorComponent._selectRef.select.control;e&&e.clientHeight!==this.state.multiComparatorHeight&&(this.props.onHeightChange(e.clientHeight-this.state.multiComparatorHeight),this.setState({multiComparatorHeight:e.clientHeight}))}}}()},{key:"refreshComparatorSuggestions",value:function(){return function(){var e=this,t=this.props.datasource,n=this.props.adhocFilter.subject,r=this.props.adhocFilter.clause===s.CLAUSES.HAVING;n&&t&&t.filter_select&&!r&&(this.state.activeRequest&&this.state.activeRequest.abort(),this.setState({activeRequest:E.ajax({type:"GET",url:"/superset/filter/"+t.type+"/"+t.id+"/"+n+"/",success:function(t){return e.setState({suggestions:t,activeRequest:null})}})}))}}()},{key:"isOperatorRelevant",value:function(){return function(e){return!("druid"===this.props.datasource.type&&h.TABLE_ONLY_OPERATORS.indexOf(e)>=0||"table"===this.props.datasource.type&&h.DRUID_ONLY_OPERATORS.indexOf(e)>=0||this.props.adhocFilter.clause===s.CLAUSES.HAVING&&-1===h.HAVING_OPERATORS.indexOf(e))}}()},{key:"focusComparator",value:function(){return function(e){e&&e.focus()}}()},{key:"multiComparatorRef",value:function(){return function(e){e&&(this.multiComparatorComponent=e)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.adhocFilter,n=e.options,a=e.datasource,l={value:t.subject?{value:t.subject}:void 0,onChange:this.onSubjectChange,optionRenderer:(0,g.default)(function(e){return o.default.createElement(m.default,{option:e})}),valueRenderer:function(e){return o.default.createElement("span",null,e.value)},valueKey:"filterOptionName",noResultsText:(0,p.t)("No such column found. To filter on a metric, try the Custom SQL tab.")};l="druid"===a.type?Object.assign({},l,{placeholder:(0,p.t)("%s column(s) and metric(s)",n.length),options:n}):Object.assign({},l,{placeholder:t.clause===s.CLAUSES.WHERE?(0,p.t)("%s column(s)",n.length):(0,p.t)("To filter on a metric, use Custom SQL tab."),options:n.filter(function(e){return e.column_name})});var u={placeholder:(0,p.t)("%s operators(s)",Object.keys(h.OPERATORS).length),options:Object.keys(h.OPERATORS).filter(this.isOperatorRelevant).map(function(e){return{operator:e}}),value:t.operator,onChange:this.onOperatorChange,optionRenderer:(0,g.default)(function(e){return O(e.operator)}),valueRenderer:function(e){return o.default.createElement("span",null,O(e.operator))},valueKey:"operator"};return o.default.createElement("span",null,o.default.createElement(i.FormGroup,{className:"adhoc-filter-simple-column-dropdown"},o.default.createElement(y.default,r({},this.selectProps,l))),o.default.createElement(i.FormGroup,null,o.default.createElement(y.default,r({},this.selectProps,u))),o.default.createElement(i.FormGroup,null,h.MULTI_OPERATORS.indexOf(t.operator)>=0||this.state.suggestions.length>0?o.default.createElement(v.default,{multi:h.MULTI_OPERATORS.indexOf(t.operator)>=0,freeForm:!0,name:"filter-comparator-value",value:t.comparator,isLoading:!1,choices:this.state.suggestions,onChange:this.onComparatorChange,showHeader:!1,noResultsText:(0,p.t)("type a value here"),refFunc:this.multiComparatorRef,disabled:"IS NOT NULL"===t.operator||"IS NULL"===t.operator}):o.default.createElement("input",{ref:this.focusComparator,type:"text",onChange:this.onInputComparatorChange,value:t.comparator||"",className:"form-control input-sm",placeholder:(0,p.t)("Filter value")})))}}()}]),t}();t.default=S,S.propTypes=C,S.defaultProps={datasource:{}}},1781:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=l(n(1)),a=l(n(0)),o=l(n(293));function l(e){return e&&e.__esModule?e:{default:e}}var i={adhocMetric:l(n(291)).default,showType:a.default.bool};function u(e){var t=e.adhocMetric,n=e.showType;return r.default.createElement("div",null,n&&r.default.createElement(o.default,{type:"expression"}),r.default.createElement("span",{className:"m-r-5 option-label"},t.label))}u.propTypes=i},1782:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=g(n(1)),l=g(n(0)),i=g(n(267));n(359),n(360),n(457);var u=n(12),s=g(n(266)),c=n(556),f=n(408),d=g(f),p=g(n(291)),h=g(n(229)),m=g(n(397)),y=g(n(396)),v=n(11);function g(e){return e&&e.__esModule?e:{default:e}}var b={adhocFilter:l.default.instanceOf(d.default).isRequired,onChange:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([h.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),p.default])).isRequired,height:l.default.number.isRequired},E=ace.acequire("ace/ext/language_tools"),C=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.onSqlExpressionChange=n.onSqlExpressionChange.bind(n),n.onSqlExpressionClauseChange=n.onSqlExpressionClauseChange.bind(n),n.handleAceEditorRef=n.handleAceEditorRef.bind(n),n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!1,selectWrap:s.default},E){var r=c.sqlWords.concat(n.props.options.map(function(e){return e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null})),a={getCompletions:function(){return function(e,t,n,a,o){o(null,r)}}()};E.setCompleters([a])}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"componentDidUpdate",value:function(){return function(){this.aceEditorRef.editor.resize()}}()},{key:"onSqlExpressionClauseChange",value:function(){return function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e&&e.clause,expressionType:f.EXPRESSION_TYPES.SQL}))}}()},{key:"onSqlExpressionChange",value:function(){return function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:f.EXPRESSION_TYPES.SQL}))}}()},{key:"handleAceEditorRef",value:function(){return function(e){e&&(this.aceEditorRef=e)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.adhocFilter,n=e.height,a={placeholder:(0,v.t)("choose WHERE or HAVING..."),options:Object.keys(f.CLAUSES).map(function(e){return{clause:e}}),value:t.clause,onChange:this.onSqlExpressionClauseChange,optionRenderer:(0,y.default)(function(e){return e.clause}),valueRenderer:function(e){return o.default.createElement("span",null,e.clause)},valueKey:"clause"};return o.default.createElement("span",null,o.default.createElement(u.FormGroup,{className:"filter-edit-clause-section"},o.default.createElement(m.default,r({},this.selectProps,a,{className:"filter-edit-clause-dropdown"})),o.default.createElement("span",{className:"filter-edit-clause-info"},o.default.createElement("strong",null,"Where")," filters by columns.",o.default.createElement("br",null),o.default.createElement("strong",null,"Having")," filters by metrics.")),o.default.createElement(u.FormGroup,null,o.default.createElement(i.default,{ref:this.handleAceEditorRef,mode:"sql",theme:"github",height:n-100+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:t.sqlExpression||t.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"adhoc-filter-sql-editor",wrapEnabled:!0})))}}()}]),t}();t.default=C,C.propTypes=b},1789:function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=g(n(52)),o=g(n(1)),l=g(n(0)),i=g(n(15)),u=g(n(266)),s=n(75),c=n(12),f=g(n(1182)),d=g(n(1192)),p=g(n(1193)),h=g(n(269)),m=g(n(397)),y=g(n(396));n(2735);var v=n(11);function g(e){return e&&e.__esModule?e:{default:e}}var b={time_range:"__time_range",granularity_sqla:"__time_col",time_grain_sqla:"__time_grain",druid_time_origin:"__time_origin",granularity:"__granularity"},E={origSelectedValues:l.default.object,instantFiltering:l.default.bool,filtersChoices:l.default.object,onChange:l.default.func,showDateFilter:l.default.bool,showSqlaTimeGrain:l.default.bool,showSqlaTimeColumn:l.default.bool,showDruidTimeGrain:l.default.bool,showDruidTimeOrigin:l.default.bool,datasource:l.default.object.isRequired},C={origSelectedValues:{},onChange:function(){return function(){}}(),showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,showDruidTimeGrain:!1,showDruidTimeOrigin:!1,instantFiltering:!0},O=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={selectedValues:e.origSelectedValues,hasChanged:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),r(t,[{key:"getControlData",value:function(){return function(e){var t=Object.assign({},h.default[e]),n={name:e,key:"control-"+e,value:this.state.selectedValues[b[e]],actions:{setControlValue:this.changeFilter.bind(this)}};Object.assign(t,n);var r=t.mapStateToProps;return r?Object.assign({},t,r(this.props)):t}}()},{key:"clickApply",value:function(){return function(){var e=this,t=this.state.selectedValues;Object.keys(t).forEach(function(n,r,a){var o=!1;r===a.length-1&&(o=!0),e.props.onChange(n,t[n],!1,o)}),this.setState({hasChanged:!1})}}()},{key:"changeFilter",value:function(){return function(e,t){var n=b[e]||e,r=null;null!==t&&(r=Array.isArray(t)?t.map(function(e){return e.value}):t.value?t.value:t);var a=Object.assign({},this.state.selectedValues);a[n]=r,this.setState({selectedValues:a,hasChanged:!0}),this.props.instantFiltering&&this.props.onChange(n,r,!1,!0)}}()},{key:"render",value:function(){return function(){var e=this,t=void 0;this.props.showDateFilter&&(t=o.default.createElement("div",{className:"row space-1"},o.default.createElement("div",{className:"col-lg-12 col-xs-12"},o.default.createElement(f.default,{name:"__time_range",label:(0,v.t)("Time range"),description:(0,v.t)("Select start and end date"),onChange:this.changeFilter.bind(this,"__time_range"),value:this.state.selectedValues.__time_range}))));var n=[],r=[],l=[];for(var i in this.props.showSqlaTimeGrain&&r.push("time_grain_sqla"),this.props.showSqlaTimeColumn&&r.push("granularity_sqla"),this.props.showDruidTimeGrain&&l.push("granularity"),this.props.showDruidTimeOrigin&&l.push("druid_time_origin"),r.length&&n.push(o.default.createElement(d.default,{key:"sqla-filters",className:"control-row",controls:r.map(function(t){return o.default.createElement(p.default,e.getControlData(t))})})),l.length&&n.push(o.default.createElement(d.default,{key:"druid-filters",className:"control-row",controls:l.map(function(t){return o.default.createElement(p.default,e.getControlData(t))})})),this.state.selectedValues)if(this.state.selectedValues.hasOwnProperty(i)&&i in this.props.filtersChoices){var h=this.props.filtersChoices[i].map(function(e){return e.id}),g=!0,b=!1,E=void 0;try{for(var C,O=this.state.selectedValues[i][Symbol.iterator]();!(g=(C=O.next()).done);g=!0){var _=C.value;if(-1===h.indexOf(_)){var S={filter:i,id:_,text:_,metric:0};this.props.filtersChoices[i].unshift(S)}}}catch(e){b=!0,E=e}finally{try{!g&&O.return&&O.return()}finally{if(b)throw E}}}var T=Object.keys(this.props.filtersChoices).map(function(t){var n=e.props.filtersChoices[t],r={};return r[t]=a.default.max(n,function(e){return e.metric}),o.default.createElement("div",{key:t,className:"m-b-5"},e.props.datasource.verbose_map[t]||t,o.default.createElement(m.default,{placeholder:(0,v.t)("Select [%s]",t),key:t,multi:!0,value:e.state.selectedValues[t],options:n.map(function(e){var t=Math.round(e.metric/r[e.filter]*100),n={backgroundImage:"linear-gradient(to right, lightgrey, lightgrey "+t+"%, rgba(0,0,0,0) "+t+"%",padding:"2px 5px"};return{value:e.id,label:e.id,style:n}}),onChange:e.changeFilter.bind(e,t),selectComponent:s.Creatable,selectWrap:u.default,optionRenderer:(0,y.default)(function(e){return e.label})}))});return o.default.createElement("div",{className:"scrollbar-container"},o.default.createElement("div",{className:"scrollbar-content"},t,n,T,!this.props.instantFiltering&&o.default.createElement(c.Button,{bsSize:"small",bsStyle:"primary",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,v.t)("Apply"))))}}()}]),t}();O.propTypes=E,O.defaultProps=C,e.exports=function(e,t){a.default.select(e.selector).selectAll("*").remove();var n=e.formData,r={};n.groupby.forEach(function(e){r[e]=t.data[e]}),i.default.render(o.default.createElement(O,{filtersChoices:r,onChange:e.addFilter,showDateFilter:n.date_filter,showSqlaTimeGrain:n.show_sqla_time_granularity,showSqlaTimeColumn:n.show_sqla_time_column,showDruidTimeGrain:n.show_druid_time_granularity,showDruidTimeOrigin:n.show_druid_time_origin,datasource:e.datasource,origSelectedValues:e.getFilters()||{},instantFiltering:n.instant_filtering}),document.getElementById(e.containerId))}},229:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));t.default=r.default.shape({column_name:r.default.string.isRequired,type:r.default.string})},2735:function(e,t,n){},291:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(0)),a=n(292),o=i(n(229)),l=n(358);function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default.oneOfType([r.default.shape({expressionType:r.default.oneOf([l.EXPRESSION_TYPES.SIMPLE]).isRequired,column:o.default.isRequired,aggregate:r.default.oneOf(Object.keys(a.AGGREGATES)).isRequired,label:r.default.string.isRequired}),r.default.shape({expressionType:r.default.oneOf([l.EXPRESSION_TYPES.SQL]).isRequired,sqlExpression:r.default.string.isRequired,label:r.default.string.isRequired})])},292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AGGREGATES={AVG:"AVG",COUNT:"COUNT ",COUNT_DISTINCT:"COUNT_DISTINCT",MAX:"MAX",MIN:"MIN",SUM:"SUM"};var r=t.OPERATORS={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","not in":"not in",LIKE:"LIKE",regex:"regex","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL"};t.TABLE_ONLY_OPERATORS=[r.LIKE],t.DRUID_ONLY_OPERATORS=[r.regex],t.HAVING_OPERATORS=[r["=="],r["!="],r[">"],r["<"],r[">="],r["<="]],t.MULTI_OPERATORS=[r.in,r["not in"]],t.sqlaAutoGeneratedMetricNameRegex=/^(sum|min|max|avg|count|count_distinct)__.*$/i,t.sqlaAutoGeneratedMetricRegex=/^(LONG|DOUBLE|FLOAT)?(SUM|AVG|MAX|MIN|COUNT)\([A-Z0-9_."]*\)$/i,t.druidAutoGeneratedMetricRegex=/^(LONG|DOUBLE|FLOAT)?(SUM|MAX|MIN|COUNT)\([A-Z0-9_."]*\)$/i,t.EXPLORE_ONLY_VIZ_TYPE=["separator","markup"]},358:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPRESSION_TYPES=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(292);var o=t.EXPRESSION_TYPES={SIMPLE:"SIMPLE",SQL:"SQL"};function l(e){if(e.sqlExpression&&a.sqlaAutoGeneratedMetricRegex.test(e.sqlExpression)){var t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function i(e){if(e.sqlExpression&&a.sqlaAutoGeneratedMetricRegex.test(e.sqlExpression)){var t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}var u=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expressionType=t.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE){var n=l(t);this.column=t.column||n&&{column_name:n},this.aggregate=t.aggregate||i(t),this.sqlExpression=null}else this.expressionType===o.SQL&&(this.sqlExpression=t.sqlExpression,this.column=null,this.aggregate=null);this.hasCustomLabel=!(!t.hasCustomLabel||!t.label),this.fromFormData=!!t.optionName,this.label=this.hasCustomLabel?t.label:this.getDefaultLabel(),this.optionName=t.optionName||"metric_"+Math.random().toString(36).substring(2,15)+"_"+Math.random().toString(36).substring(2,15)}return r(e,[{key:"getDefaultLabel",value:function(){return function(){var e=this.translateToSql();return e.length<43?e:e.substring(0,40)+"..."}}()},{key:"translateToSql",value:function(){return function(){return this.expressionType===o.SIMPLE?(this.aggregate||"")+"("+(this.column&&this.column.column_name||"")+")":this.expressionType===o.SQL?this.sqlExpression:""}}()},{key:"duplicateWith",value:function(){return function(t){return new e(Object.assign({},this,t))}}()},{key:"equals",value:function(){return function(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}}()},{key:"isValid",value:function(){return function(){return this.expressionType===o.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===o.SQL&&!!this.sqlExpression}}()},{key:"inferSqlExpressionAggregate",value:function(){return function(){return i(this)}}()},{key:"inferSqlExpressionColumn",value:function(){return function(){return l(this)}}()}]),e}();t.default=u},396:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.default=function(e){function t(t){var n=t.focusedOption,o=t.focusOption,l=t.key,i=t.option,u=t.selectValue,s=t.style,c=t.valueArray;if(!i)return null;var f=["VirtualizedSelectOption"];i===n&&f.push("VirtualizedSelectFocusedOption"),i.disabled&&f.push("VirtualizedSelectDisabledOption"),c&&c.indexOf(i)>=0&&f.push("VirtualizedSelectSelectedOption"),i.className&&f.push(i.className);var d=i.disabled?{}:{onClick:function(){return function(){return u(i)}}(),onMouseEnter:function(){return function(){return o(i)}}()};return a.default.createElement("div",r({className:f.join(" "),key:l,style:Object.assign(i.style||{},s),title:i.title},d),e(i))}return t.propTypes={focusedOption:o.default.object.isRequired,focusOption:o.default.func.isRequired,key:o.default.string,option:o.default.object,selectValue:o.default.func.isRequired,style:o.default.object,valueArray:o.default.array},t};var a=l(n(1)),o=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}},397:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(n(1)),l=u(n(0)),i=u(n(75));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"onPaste",value:function(){return function(e){var t=this;if(this.props.multi){e.preventDefault();var n=e.clipboardData.getData("Text");if(n){var r="["+this.props.separator+"]+",a=n.split(new RegExp(r)).map(function(e){return e.trim()}),o=this.props.isValidNewOption,l=this.props.value||[],i={},u={};this.props.options.forEach(function(e){i[e[t.props.valueKey]]=1});var c=[];l.forEach(function(e){var n;c.push((s(n={},t.props.labelKey,e),s(n,t.props.valueKey,e),n)),u[e]=1}),(c=c.concat(a.filter(function(e){var n=!u[e];return u[e]=1,n&&(o?o(s({},t.props.labelKey,e)):!!e)}).map(function(e){var n,r=(s(n={},t.props.labelKey,e),s(n,t.props.valueKey,e),n);return i[e]||t.props.options.unshift(r),r}))).length&&this.props.onChange&&this.props.onChange(c)}}}}()},{key:"render",value:function(){return function(){var e=this,t=this.props.selectWrap,n=function(t){e.props.refFunc&&e.props.refFunc(t),e.pasteInput=t},a={onPaste:this.onPaste.bind(this)};return o.default.createElement(t,r({},this.props,{ref:n,inputProps:a}))}}()}]),t}();t.default=c,c.propTypes={separator:l.default.string.isRequired,selectWrap:l.default.func.isRequired,refFunc:l.default.func,onChange:l.default.func.isRequired,valueKey:l.default.string.isRequired,labelKey:l.default.string.isRequired,options:l.default.array,multi:l.default.bool.isRequired,value:l.default.any,isValidNewOption:l.default.func},c.defaultProps={separator:",",selectWrap:i.default,valueKey:"value",labelKey:"label",options:[],multi:!1}},407:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=h(n(1)),l=h(n(0)),i=h(n(266)),u=n(75),s=h(u),c=h(n(65)),f=n(11),d=h(n(396)),p=h(n(397));function h(e){return e&&e.__esModule?e:{default:e}}var m={choices:l.default.array,clearable:l.default.bool,description:l.default.string,disabled:l.default.bool,freeForm:l.default.bool,isLoading:l.default.bool,label:l.default.string,multi:l.default.bool,name:l.default.string.isRequired,onChange:l.default.func,onFocus:l.default.func,value:l.default.oneOfType([l.default.string,l.default.number,l.default.array]),showHeader:l.default.bool,optionRenderer:l.default.func,valueRenderer:l.default.func,valueKey:l.default.string,options:l.default.array,placeholder:l.default.string,noResultsText:l.default.string,refFunc:l.default.func,filterOption:l.default.func},y={choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:function(){return function(){}}(),onFocus:function(){return function(){}}(),showHeader:!0,optionRenderer:function(){return function(e){return e.label}}(),valueRenderer:function(){return function(e){return e.label}}(),valueKey:"value",noResultsText:(0,f.t)("No results found")},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={options:n.getOptions(e)},n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),a(t,[{key:"componentWillReceiveProps",value:function(){return function(e){if(e.choices!==this.props.choices||e.options!==this.props.options){var t=this.getOptions(e);this.setState({options:t})}}}()},{key:"onChange",value:function(){return function(e){var t=this,n=e?e[this.props.valueKey]:null;this.props.multi&&(n=e?e.map(function(e){return e[t.props.valueKey]}):null),this.props.onChange(n)}}()},{key:"getOptions",value:function(){return function(e){if(e.options)return e.options;var t=e.choices.map(function(e){var t=void 0;if(Array.isArray(e)){var n=e.length>1?e[1]:e[0];t={value:e[0],label:n}}else t=Object.is(e)?e:{value:e,label:e};return t});if(e.freeForm){var n=t.map(function(e){return e.value});if(e.value){var r=e.value;Array.isArray(r)||(r=[r]),r.forEach(function(e){n.indexOf(e)<0&&t.push({value:e,label:e})})}}return t}}()},{key:"render",value:function(){return function(){var e=this.props.placeholder||(0,f.t)("%s option(s)",this.state.options.length),t={multi:this.props.multi,name:"select-"+this.props.name,placeholder:e,options:this.state.options,value:this.props.value,labelKey:"label",valueKey:this.props.valueKey,autosize:!1,clearable:this.props.clearable,isLoading:this.props.isLoading,onChange:this.onChange,onFocus:this.props.onFocus,optionRenderer:(0,d.default)(this.props.optionRenderer),valueRenderer:this.props.valueRenderer,noResultsText:this.props.noResultsText,selectComponent:this.props.freeForm?u.Creatable:s.default,disabled:this.props.disabled,refFunc:this.props.refFunc,filterOption:this.props.filterOption};return o.default.createElement("div",null,this.props.showHeader&&o.default.createElement(c.default,this.props),o.default.createElement(p.default,r({},t,{selectWrap:i.default})))}}()}]),t}();t.default=v,v.propTypes=m,v.defaultProps=y},408:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLAUSES=t.EXPRESSION_TYPES=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(292);var o=t.EXPRESSION_TYPES={SIMPLE:"SIMPLE",SQL:"SQL"},l=(t.CLAUSES={HAVING:"HAVING",WHERE:"WHERE"},{"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",in:"in","not in":"not in",LIKE:"like",regex:"regex","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL"});function i(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).useSimple;if(e.expressionType===o.SIMPLE||t){var n=a.MULTI_OPERATORS.indexOf(e.operator)>=0,r=e.subject,i=l[e.operator],u=Array.isArray(e.comparator)?e.comparator.join("','"):e.comparator;return r+" "+i+" "+(n?"('":"")+u+(n?"')":"")}return e.expressionType===o.SQL?e.sqlExpression:""}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expressionType=t.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE?(this.subject=t.subject,this.operator=t.operator,this.comparator=t.comparator,this.clause=t.clause,this.sqlExpression=null):this.expressionType===o.SQL&&(this.sqlExpression="string"==typeof t.sqlExpression?t.sqlExpression:i(t,{useSimple:!0}),this.clause=t.clause,this.subject=null,this.operator=null,this.comparator=null),this.fromFormData=!!t.filterOptionName,this.filterOptionName=t.filterOptionName||"filter_"+Math.random().toString(36).substring(2,15)+"_"+Math.random().toString(36).substring(2,15)}return r(e,[{key:"duplicateWith",value:function(){return function(t){return new e(Object.assign({},this,{expressionType:this.expressionType,subject:this.subject,operator:this.operator,clause:this.clause,sqlExpression:this.sqlExpression,fromFormData:this.fromFormData,filterOptionName:this.filterOptionName},t))}}()},{key:"equals",value:function(){return function(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.comparator===this.comparator&&e.subject===this.subject}}()},{key:"isValid",value:function(){return function(){return this.expressionType===o.SIMPLE?"IS NOT NULL"===this.operator||"IS NULL"===this.operator?!(!this.operator||!this.subject):!!(this.operator&&this.subject&&this.comparator&&this.comparator.length>0&&this.clause):this.expressionType===o.SQL&&!(!this.sqlExpression||!this.clause)}}()},{key:"getDefaultLabel",value:function(){return function(){var e=this.translateToSql();return e.length<43?e:e.substring(0,40)+"..."}}()},{key:"translateToSql",value:function(){return function(){return i(this)}}()}]),e}();t.default=u},453:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=n(12),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(270)),u=s(n(65));function s(e){return e&&e.__esModule?e:{default:e}}var c={onChange:o.default.func,onFocus:o.default.func,value:o.default.oneOfType([o.default.string,o.default.number]),isFloat:o.default.bool,isInt:o.default.bool,disabled:o.default.bool},f={onChange:function(){return function(){}}(),onFocus:function(){return function(){}}(),value:"",isInt:!1,isFloat:!1,disabled:!1},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onChange",value:function(){return function(e){var t=e.target.value,n=[];if(""!==t&&this.props.isFloat){var r=i.numeric(t);r?n.push(r):t=parseFloat(t)}if(""!==t&&this.props.isInt){var a=i.integer(t);a?n.push(a):t=parseInt(t,10)}this.props.onChange(t,n)}}()},{key:"render",value:function(){return function(){var e=this.props.value,t=void 0!==e&&null!==e?e.toString():"";return a.default.createElement("div",null,a.default.createElement(u.default,this.props),a.default.createElement(l.FormGroup,{controlId:"formInlineName",bsSize:"small"},a.default.createElement(l.FormControl,{type:"text",placeholder:"",onChange:this.onChange,onFocus:this.props.onFocus,value:t,disabled:this.props.disabled})))}}()}]),t}();t.default=d,d.propTypes=c,d.defaultProps=f},550:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(n(1)),l=s(n(0)),i=s(n(65)),u=s(n(559));function s(e){return e&&e.__esModule?e:{default:e}}var c={value:l.default.bool,label:l.default.string,onChange:l.default.func},f={value:!1,onChange:function(){return function(){}}()},d={paddingRight:"5px"},p=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].Component),a(t,[{key:"onChange",value:function(){return function(){this.props.onChange(!this.props.value)}}()},{key:"renderCheckbox",value:function(){return function(){return o.default.createElement(u.default,{onChange:this.onChange.bind(this),style:d,checked:!!this.props.value})}}()},{key:"render",value:function(){return function(){return this.props.label?o.default.createElement(i.default,r({},this.props,{leftNode:this.renderCheckbox()})):this.renderCheckbox()}}()}]),t}();t.default=p,p.propTypes=c,p.defaultProps=f},551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=l(n(1)),a=l(n(0)),o=l(n(66));function l(e){return e&&e.__esModule?e:{default:e}}var i={title:a.default.string.isRequired,isSelected:a.default.bool.isRequired,onSelect:a.default.func.isRequired,info:a.default.string,children:a.default.node.isRequired};function u(e){var t=e.title,n=e.isSelected,a=e.children,l=e.onSelect,i=e.info;return r.default.createElement("div",{className:"PopoverSection "+(n?"":"dimmed")},r.default.createElement("div",{onClick:l,className:"pointer"},r.default.createElement("strong",null,t),"  ",i&&r.default.createElement(o.default,{tooltip:i,label:"date-free-tooltip"})," ",r.default.createElement("i",{className:n?"fa fa-check text-primary":""})),r.default.createElement("div",{className:"m-t-5 m-l-5"},a))}u.propTypes=i},553:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));t.default=r.default.shape({metric_name:r.default.string.isRequired,expression:r.default.string.isRequired})},556:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sqlWords=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=s(n(267));n(359),n(360),n(457);var i=s(n(273)),u=n(250);function s(e){return e&&e.__esModule?e:{default:e}}var c=i.default.acequire("ace/ext/language_tools"),f=[].concat("SELECT|INSERT|UPDATE|DELETE|FROM|WHERE|AND|OR|GROUP|BY|ORDER|LIMIT|OFFSET|HAVING|AS|CASE|WHEN|ELSE|END|TYPE|LEFT|RIGHT|JOIN|ON|OUTER|DESC|ASC|UNION|CREATE|TABLE|PRIMARY|KEY|IF|FOREIGN|NOT|REFERENCES|DEFAULT|NULL|INNER|CROSS|NATURAL|DATABASE|DROP|GRANT|SUM|MAX|MIN|COUNT|AVG|DISTINCT".split("|"),"INT|NUMERIC|DECIMAL|DATE|VARCHAR|CHAR|BIGINT|FLOAT|DOUBLE|BIT|BINARY|TEXT|SET|TIMESTAMP|MONEY|REAL|NUMBER|INTEGER".split("|")),d=t.sqlWords=f.map(function(e){return{name:e,value:e,score:60,meta:"sql"}}),p={actions:o.default.object.isRequired,onBlur:o.default.func,sql:o.default.string.isRequired,tables:o.default.array,queryEditor:o.default.object.isRequired,height:o.default.string,hotkeys:o.default.arrayOf(o.default.shape({key:o.default.string.isRequired,descr:o.default.string.isRequired,func:o.default.func.isRequired})),onChange:o.default.func},h={onBlur:function(){return function(){}}(),onChange:function(){return function(){}}(),tables:[]},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={sql:e.sql,selectedText:""},n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"componentDidMount",value:function(){return function(){this.props.actions.queryEditorSetSelectedText(this.props.queryEditor,null),this.setAutoCompleter(this.props)}}()},{key:"componentWillReceiveProps",value:function(){return function(e){(0,u.areArraysShallowEqual)(this.props.tables,e.tables)||this.setAutoCompleter(e),e.sql!==this.props.sql&&this.setState({sql:e.sql})}}()},{key:"onBlur",value:function(){return function(){this.props.onBlur(this.state.sql)}}()},{key:"onAltEnter",value:function(){return function(){this.props.onBlur(this.state.sql)}}()},{key:"onEditorLoad",value:function(){return function(e){var t=this;e.commands.addCommand({name:"runQuery",bindKey:{win:"Alt-enter",mac:"Alt-enter"},exec:function(){t.onAltEnter()}}),this.props.hotkeys.forEach(function(t){e.commands.addCommand({name:t.name,bindKey:{win:t.key,mac:t.key},exec:t.func})}),e.$blockScrolling=1/0,e.selection.on("changeSelection",function(){var n=e.getSelectedText();n!==t.state.selectedText&&1!==n.length&&(t.setState({selectedText:n}),t.props.actions.queryEditorSetSelectedText(t.props.queryEditor,n))})}}()},{key:"onChange",value:function(){return function(e){this.setState({sql:e}),this.props.onChange(e)}}()},{key:"getCompletions",value:function(){return function(e,t,n,r,a){a(null,this.state.words)}}()},{key:"setAutoCompleter",value:function(){return function(e){var t=this,n=[],r={};(e.tables||[]).forEach(function(e){n.push({name:e.name,value:e.name,score:55,meta:"table"}),(e.columns||[]).forEach(function(e){r[e.name]=null})}),n=n.concat(Object.keys(r).map(function(e){return{name:e,value:e,score:50,meta:"column"}}),d),this.setState({words:n},function(){var e={getCompletions:t.getCompletions.bind(t)};c&&c.setCompleters([e])})}}()},{key:"render",value:function(){return function(){return a.default.createElement(l.default,{mode:"sql",theme:"github",onLoad:this.onEditorLoad.bind(this),onBlur:this.onBlur.bind(this),height:this.props.height,onChange:this.onChange,width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.sql})}}()}]),t}();m.defaultProps=h,m.propTypes=p,t.default=m},560:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(n(1)),l=s(n(0)),i=s(n(75)),u=n(11);function s(e){return e&&e.__esModule?e:{default:e}}var c=window.$=n(22),f={dataEndpoint:l.default.string.isRequired,onChange:l.default.func.isRequired,mutator:l.default.func.isRequired,onAsyncError:l.default.func,value:l.default.oneOfType([l.default.number,l.default.arrayOf(l.default.number)]),valueRenderer:l.default.func,placeholder:l.default.string,autoSelect:l.default.bool},d={placeholder:(0,u.t)("Select ..."),valueRenderer:function(){return function(e){return o.default.createElement("div",null,e.label)}}(),onAsyncError:function(){return function(){}}()},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!1,options:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),a(t,[{key:"componentDidMount",value:function(){return function(){this.fetchOptions()}}()},{key:"onChange",value:function(){return function(e){this.props.onChange(e)}}()},{key:"fetchOptions",value:function(){return function(){var e=this;this.setState({isLoading:!0});var t=this.props.mutator;c.get(this.props.dataEndpoint).done(function(n){e.setState({options:t?t(n):n,isLoading:!1}),!e.props.value&&e.props.autoSelect&&e.state.options.length&&e.onChange(e.state.options[0])}).fail(function(t){e.props.onAsyncError(t.responseText)}).always(function(){e.setState({isLoading:!1})})}}()},{key:"render",value:function(){return function(){return o.default.createElement("div",null,o.default.createElement(i.default,r({placeholder:this.props.placeholder,options:this.state.options,value:this.props.value,isLoading:this.state.isLoading,onChange:this.onChange.bind(this),valueRenderer:this.props.valueRenderer},this.props)))}}()}]),t}();p.propTypes=f,p.defaultProps=d,t.default=p},609:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=i(n(1)),a=i(n(0)),o=i(n(293)),l=i(n(66));function i(e){return e&&e.__esModule?e:{default:e}}var u={metric:a.default.object.isRequired,openInNewWindow:a.default.bool,showFormula:a.default.bool,showType:a.default.bool,url:a.default.string};function s(e){var t=e.metric,n=e.openInNewWindow,a=e.showFormula,i=e.showType,u=e.url,s=t.verbose_name||t.metric_name||t.label,c=u?r.default.createElement("a",{href:u,target:n?"_blank":null},s):s;return r.default.createElement("div",null,i&&r.default.createElement(o.default,{type:"expression"}),r.default.createElement("span",{className:"m-r-5 option-label"},c),t.description&&r.default.createElement(l.default,{className:"m-r-5 text-muted",icon:"info",tooltip:t.description,label:"descr-"+t.metric_name}),a&&r.default.createElement(l.default,{className:"m-r-5 text-muted",icon:"question-circle-o",tooltip:t.expression,label:"expr-"+t.metric_name}),t.warning_text&&r.default.createElement(l.default,{className:"m-r-5 text-danger",icon:"warning",tooltip:t.warning_text,label:"warn-"+t.metric_name}))}s.propTypes=u,s.defaultProps={showFormula:!0,showType:!1}},65:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=n(12),i=s(n(66)),u=n(11);function s(e){return e&&e.__esModule?e:{default:e}}var c={label:o.default.string,description:o.default.string,validationErrors:o.default.array,renderTrigger:o.default.bool,rightNode:o.default.node,leftNode:o.default.node,onClick:o.default.func,hovered:o.default.bool,tooltipOnClick:o.default.func,warning:o.default.string,danger:o.default.string},f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"renderOptionalIcons",value:function(){return function(){return this.props.hovered?a.default.createElement("span",null,this.props.description&&a.default.createElement("span",null,a.default.createElement(i.default,{label:(0,u.t)("description"),tooltip:this.props.description,placement:"top",onClick:this.props.tooltipOnClick})," "),this.props.renderTrigger&&a.default.createElement("span",null,a.default.createElement(i.default,{label:(0,u.t)("bolt"),tooltip:(0,u.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null}}()},{key:"render",value:function(){return function(){if(!this.props.label)return null;var e=this.props.validationErrors.length>0?"text-danger":"";return a.default.createElement("div",{className:"ControlHeader"},a.default.createElement("div",{className:"pull-left"},a.default.createElement(l.ControlLabel,null,this.props.leftNode&&a.default.createElement("span",null,this.props.leftNode),a.default.createElement("span",{onClick:this.props.onClick,className:e,style:{cursor:this.props.onClick?"pointer":""}},this.props.label)," ",this.props.warning&&a.default.createElement("span",null,a.default.createElement(l.OverlayTrigger,{placement:"top",overlay:a.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.warning)},a.default.createElement("i",{className:"fa fa-exclamation-circle text-warning"}))," "),this.props.danger&&a.default.createElement("span",null,a.default.createElement(l.OverlayTrigger,{placement:"top",overlay:a.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.danger)},a.default.createElement("i",{className:"fa fa-exclamation-circle text-danger"}))," "),this.props.validationErrors.length>0&&a.default.createElement("span",null,a.default.createElement(l.OverlayTrigger,{placement:"top",overlay:a.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.validationErrors.join(" "))},a.default.createElement("i",{className:"fa fa-exclamation-circle text-danger"}))," "),this.renderOptionalIcons())),this.props.rightNode&&a.default.createElement("div",{className:"pull-right"},this.props.rightNode),a.default.createElement("div",{className:"clearfix"}))}}()}]),t}();t.default=f,f.propTypes=c,f.defaultProps={validationErrors:[],renderTrigger:!1,hovered:!1}},802:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=_(n(1194)),a=_(n(884)),o=_(n(550)),l=_(n(1708)),i=_(n(1714)),u=_(n(1715)),s=_(n(1716)),c=_(n(1182)),f=_(n(1763)),d=_(n(1764)),p=_(n(886)),h=_(n(407)),m=_(n(887)),y=_(n(885)),v=_(n(453)),g=_(n(1765)),b=_(n(1766)),E=_(n(1768)),C=_(n(1769)),O=_(n(1776));function _(e){return e&&e.__esModule?e:{default:e}}var S={AnnotationLayerControl:r.default,BoundsControl:a.default,CheckboxControl:o.default,CollectionControl:l.default,ColorPickerControl:i.default,ColorSchemeControl:u.default,DatasourceControl:s.default,DateFilterControl:c.default,FixedOrMetricControl:f.default,HiddenControl:d.default,SelectAsyncControl:p.default,SelectControl:h.default,SpatialControl:m.default,TextAreaControl:y.default,TextControl:v.default,TimeSeriesColumnControl:g.default,ViewportControl:b.default,VizTypeControl:E.default,MetricsControl:C.default,AdhocFilterControl:O.default};t.default=S},884:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=n(12),i=s(n(65)),u=n(11);function s(e){return e&&e.__esModule?e:{default:e}}var c={onChange:o.default.func,value:o.default.array},f={onChange:function(){return function(){}}(),value:[null,null]},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={minMax:[null===e.value[0]?"":e.value[0],null===e.value[1]?"":e.value[1]]},n.onChange=n.onChange.bind(n),n.onMinChange=n.onMinChange.bind(n),n.onMaxChange=n.onMaxChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onMinChange",value:function(){return function(e){this.setState({minMax:[e.target.value,this.state.minMax[1]]},this.onChange)}}()},{key:"onMaxChange",value:function(){return function(e){this.setState({minMax:[this.state.minMax[0],e.target.value]},this.onChange)}}()},{key:"onChange",value:function(){return function(){var e=this.state.minMax,t=[];e[0]&&isNaN(e[0])&&t.push((0,u.t)("`Min` value should be numeric or empty")),e[1]&&isNaN(e[1])&&t.push((0,u.t)("`Max` value should be numeric or empty")),0===t.length?this.props.onChange([parseFloat(e[0]),parseFloat(e[1])],t):this.props.onChange([null,null],t)}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement(i.default,this.props),a.default.createElement(l.FormGroup,{bsSize:"small"},a.default.createElement(l.Row,null,a.default.createElement(l.Col,{xs:6},a.default.createElement(l.FormControl,{type:"text",placeholder:(0,u.t)("Min"),onChange:this.onMinChange,value:this.state.minMax[0]})),a.default.createElement(l.Col,{xs:6},a.default.createElement(l.FormControl,{type:"text",placeholder:(0,u.t)("Max"),onChange:this.onMaxChange,value:this.state.minMax[1]})))))}}()}]),t}();t.default=d,d.propTypes=c,d.defaultProps=f},885:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=f(n(1)),o=f(n(0)),l=n(12),i=f(n(267));n(359),n(639),n(641),n(487),n(1719),n(488);var u=f(n(65)),s=f(n(92)),c=n(11);function f(e){return e&&e.__esModule?e:{default:e}}var d={name:o.default.string,onChange:o.default.func,value:o.default.string,height:o.default.number,minLines:o.default.number,maxLines:o.default.number,offerEditInModal:o.default.bool,language:o.default.oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:o.default.node,readOnly:o.default.bool},p={onChange:function(){return function(){}}(),value:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1},h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"onControlChange",value:function(){return function(e){this.props.onChange(e.target.value)}}()},{key:"onAceChange",value:function(){return function(e){this.props.onChange(e)}}()},{key:"renderEditor",value:function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.value||"";return this.props.language?a.default.createElement(i.default,{mode:this.props.language,theme:"textmate",style:{border:"1px solid #CCC"},minLines:e?40:this.props.minLines,maxLines:e?1e3:this.props.maxLines,onChange:this.onAceChange.bind(this),width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:t,readOnly:this.props.readOnly}):a.default.createElement(l.FormGroup,{controlId:"formControlsTextarea"},a.default.createElement(l.FormControl,{componentClass:"textarea",placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),value:t,disabled:this.props.readOnly,style:{height:this.props.height}}))}}()},{key:"renderModalBody",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}}()},{key:"render",value:function(){return function(){var e=a.default.createElement(u.default,this.props);return a.default.createElement("div",null,e,this.renderEditor(),this.props.offerEditInModal&&a.default.createElement(s.default,{bsSize:"large",modalTitle:e,triggerNode:a.default.createElement(l.Button,{bsSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",a.default.createElement("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0)}))}}()}]),t}();t.default=h,h.propTypes=d,h.defaultProps=p},886:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(1)),a=s(n(0)),o=s(n(560)),l=s(n(65)),i=n(11),u=s(n(322));function s(e){return e&&e.__esModule?e:{default:e}}var c={dataEndpoint:a.default.string.isRequired,multi:a.default.bool,mutator:a.default.func,onAsyncErrorMessage:a.default.string,onChange:a.default.func,placeholder:a.default.string,value:a.default.oneOfType([a.default.string,a.default.number,a.default.arrayOf(a.default.string),a.default.arrayOf(a.default.number)]),addDangerToast:a.default.func.isRequired},f={multi:!0,onAsyncErrorMessage:(0,i.t)("Error while fetching data"),onChange:function(){return function(){}}(),placeholder:(0,i.t)("Select ...")},d=function(){return function(e){var t=e.value,n=e.onChange,a=e.dataEndpoint,i=e.multi,u=e.mutator,s=e.placeholder,c=e.onAsyncErrorMessage,f=function(e){var t=void 0;t=i?e.map(function(e){return e.value}):e?e.value:null,n(t)};return r.default.createElement("div",null,r.default.createElement(l.default,e),r.default.createElement(o.default,{dataEndpoint:a,onChange:f,onAsyncError:function(e){return(void 0).props.addDangerToast(c+": "+e)},mutator:u,multi:i,value:t,placeholder:s,valueRenderer:function(e){return r.default.createElement("div",null,e.label)}}))}}();d.propTypes=c,d.defaultProps=f,t.default=(0,u.default)(d)},887:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=d(n(1)),o=d(n(0)),l=n(12);n(888);var i=d(n(65)),u=d(n(407)),s=d(n(551)),c=d(n(559)),f=n(11);function d(e){return e&&e.__esModule?e:{default:e}}var p={latlong:"latlong",delimited:"delimited",geohash:"geohash"},h={onChange:o.default.func,value:o.default.object,animation:o.default.bool,choices:o.default.array},m={onChange:function(){return function(){}}(),animation:!0,choices:[]},y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.value||{},a=void 0;return e.choices.length>0&&(a=e.choices[0][0]),n.state={type:r.type||p.latlong,delimiter:r.delimiter||",",latCol:r.latCol||a,lonCol:r.lonCol||a,lonlatCol:r.lonlatCol||a,reverseCheckbox:r.reverseCheckbox||!1,geohashCol:r.geohashCol||a,value:null,errors:[]},n.toggleCheckbox=n.toggleCheckbox.bind(n),n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),r(t,[{key:"componentDidMount",value:function(){return function(){this.onChange()}}()},{key:"onChange",value:function(){return function(){var e=this.state.type,t={type:e},n=[],r=(0,f.t)("Invalid lat/long configuration.");e===p.latlong?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||n.push(r)):e===p.delimited?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||n.push(r)):e===p.geohash&&(t.geohashCol=this.state.geohashCol,t.geohashCol||n.push(r)),this.setState({value:t,errors:n}),this.props.onChange(t,n)}}()},{key:"setType",value:function(){return function(e){this.setState({type:e},this.onChange)}}()},{key:"close",value:function(){return function(){this.refs.trigger.hide()}}()},{key:"toggleCheckbox",value:function(){return function(){this.setState({reverseCheckbox:!this.state.reverseCheckbox},this.onChange)}}()},{key:"renderLabelContent",value:function(){return function(){return this.state.errors.length>0?"N/A":this.state.type===p.latlong?this.state.lonCol+" | "+this.state.latCol:this.state.type===p.delimited?""+this.state.lonlatCol:this.state.type===p.geohash?""+this.state.geohashCol:null}}()},{key:"renderSelect",value:function(){return function(e,t){var n=this;return a.default.createElement(u.default,{name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:function(){n.setType(t)},onChange:function(t){n.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t),n.onChange)}})}}()},{key:"renderPopover",value:function(){return function(){return a.default.createElement(l.Popover,{id:"filter-popover"},a.default.createElement("div",{style:{width:"300px"}},a.default.createElement(s.default,{title:(0,f.t)("Longitude & Latitude columns"),isSelected:this.state.type===p.latlong,onSelect:this.setType.bind(this,p.latlong)},a.default.createElement(l.Row,null,a.default.createElement(l.Col,{md:6},"Longitude",this.renderSelect("lonCol",p.latlong)),a.default.createElement(l.Col,{md:6},"Latitude",this.renderSelect("latCol",p.latlong)))),a.default.createElement(s.default,{title:(0,f.t)("Delimited long & lat single column"),info:(0,f.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===p.delimited,onSelect:this.setType.bind(this,p.delimited)},a.default.createElement(l.Row,null,a.default.createElement(l.Col,{md:6},"Column",this.renderSelect("lonlatCol",p.delimited)),a.default.createElement(l.Col,{md:6},(0,f.t)("Reverse lat/long "),a.default.createElement(c.default,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox})))),a.default.createElement(s.default,{title:(0,f.t)("Geohash"),isSelected:this.state.type===p.geohash,onSelect:this.setType.bind(this,p.geohash)},a.default.createElement(l.Row,null,a.default.createElement(l.Col,{md:6},"Column",this.renderSelect("geohashCol",p.geohash)))),a.default.createElement("div",{className:"clearfix"},a.default.createElement(l.Button,{bsSize:"small",className:"float-left ok",bsStyle:"primary",onClick:this.close.bind(this)},"Ok"))))}}()},{key:"render",value:function(){return function(){return a.default.createElement("div",null,a.default.createElement(i.default,this.props),a.default.createElement(l.OverlayTrigger,{animation:this.props.animation,container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},a.default.createElement(l.Label,{style:{cursor:"pointer"}},this.renderLabelContent())))}}()}]),t}();t.default=y,y.propTypes=h,y.defaultProps=m},889:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=s(n(1)),o=s(n(0)),l=n(12),i=n(890),u=s(n(891));function s(e){return e&&e.__esModule?e:{default:e}}var c={children:o.default.node.isRequired,onChange:o.default.func.isRequired,item:o.default.object.isRequired,title:o.default.node,compact:o.default.bool},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(e,t){return this.props.onChange(Object.assign({},this.props.item,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t)))}}()},{key:"render",value:function(){return function(){var e=this,t=this.props.title,n=function(t){return{onChange:e.onChange,value:e.props.item[t.props.fieldKey],compact:e.props.compact}};return a.default.createElement(l.Form,{componentClass:"fieldset",className:"CRUD"},t&&a.default.createElement("legend",null,t),(0,i.recurseReactClone)(this.props.children,u.default,n))}}()}]),t}();t.default=f,f.propTypes=c,f.defaultProps={compact:!1,title:null}},890:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recurseReactClone=function e(t,n,a){return r.default.Children.map(t,function(t){var o=t;return t&&t.type===n&&(o=r.default.cloneElement(t,a(t))),o&&o.props.children&&(o=r.default.cloneElement(o,{children:e(o.props.children,n,a)})),o})};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},891:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=i(n(1)),o=i(n(0)),l=n(12);function i(e){return e&&e.__esModule?e:{default:e}}n(1722);var u={value:o.default.any.isRequired,label:o.default.string.isRequired,descr:o.default.node,fieldKey:o.default.string.isRequired,control:o.default.node.isRequired,onChange:o.default.func,compact:o.default.bool},s={controlProps:{},onChange:function(){return function(){}}(),compact:!1,desc:null},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),r(t,[{key:"onChange",value:function(){return function(e){this.props.onChange(this.props.fieldKey,e)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.compact,n=e.value,r=e.label,o=e.control,i=e.descr,u=e.fieldKey,s=a.default.cloneElement(o,{value:n,onChange:this.onChange});return a.default.createElement(l.FormGroup,{controlId:u},a.default.createElement(l.ControlLabel,{className:"m-r-5"},r||u,t&&i&&a.default.createElement(l.OverlayTrigger,{placement:"right",overlay:a.default.createElement(l.Tooltip,{id:"field-descr",bsSize:"lg"},i)},a.default.createElement("i",{className:"fa fa-info-circle m-l-5"}))),s,a.default.createElement(l.FormControl.Feedback,null),!t&&i&&a.default.createElement(l.HelpBlock,null,i))}}()}]),t}();t.default=c,c.propTypes=u,c.defaultProps=s}}]);