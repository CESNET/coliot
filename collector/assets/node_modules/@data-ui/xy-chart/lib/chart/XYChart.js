'use strict';var _keys=require('babel-runtime/core-js/object/keys'),_keys2=_interopRequireDefault(_keys),_getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of'),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require('babel-runtime/helpers/classCallCheck'),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require('babel-runtime/helpers/createClass'),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn'),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require('babel-runtime/helpers/inherits'),_inherits3=_interopRequireDefault(_inherits2),_extends2=require('babel-runtime/helpers/extends'),_extends3=_interopRequireDefault(_extends2),_react=require('react'),_react2=_interopRequireDefault(_react),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_grid=require('@vx/grid'),_group=require('@vx/group'),_shared=require('@data-ui/shared'),_collectVoronoiData=require('../utils/collectVoronoiData'),_collectVoronoiData2=_interopRequireDefault(_collectVoronoiData),_findClosestDatums2=require('../utils/findClosestDatums'),_findClosestDatums3=_interopRequireDefault(_findClosestDatums2),_shallowCompareObjectEntries=require('../utils/shallowCompareObjectEntries'),_shallowCompareObjectEntries2=_interopRequireDefault(_shallowCompareObjectEntries),_Voronoi=require('./Voronoi'),_Voronoi2=_interopRequireDefault(_Voronoi),_chartUtils=require('../utils/chartUtils'),_collectScalesFromProps=require('../utils/collectScalesFromProps'),_collectScalesFromProps2=_interopRequireDefault(_collectScalesFromProps),_getChartDimensions2=require('../utils/getChartDimensions'),_getChartDimensions3=_interopRequireDefault(_getChartDimensions2),_propShapes=require('../utils/propShapes');Object.defineProperty(exports,'__esModule',{value:!0}),exports.defaultProps=exports.propTypes=exports.VORONOI_TRIGGER=exports.SERIES_TRIGGER=exports.CONTAINER_TRIGGER=void 0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var CONTAINER_TRIGGER=exports.CONTAINER_TRIGGER='container',SERIES_TRIGGER=exports.SERIES_TRIGGER='series',VORONOI_TRIGGER=exports.VORONOI_TRIGGER='voronoi',Y_LABEL_OFFSET=.7,propTypes=exports.propTypes=(0,_extends3.default)({},_shared.withTooltipPropTypes,{ariaLabel:_propTypes2.default.string.isRequired,children:_propTypes2.default.node,disableMouseEvents:_propTypes2.default.bool,eventTrigger:_propTypes2.default.oneOf([CONTAINER_TRIGGER,SERIES_TRIGGER,VORONOI_TRIGGER]),eventTriggerRefs:_propTypes2.default.func,height:_propTypes2.default.number.isRequired,innerRef:_propTypes2.default.func,margin:_propTypes2.default.shape({top:_propTypes2.default.number,right:_propTypes2.default.number,bottom:_propTypes2.default.number,left:_propTypes2.default.number}),renderTooltip:_propTypes2.default.func,showXGrid:_propTypes2.default.bool,showYGrid:_propTypes2.default.bool,showVoronoi:_propTypes2.default.bool,snapTooltipToDataX:_propTypes2.default.bool,snapTooltipToDataY:_propTypes2.default.bool,theme:_propShapes.themeShape,width:_propTypes2.default.number.isRequired,xScale:_propShapes.scaleShape.isRequired,yScale:_propShapes.scaleShape.isRequired}),defaultProps=exports.defaultProps={children:null,disableMouseEvents:!1,eventTrigger:SERIES_TRIGGER,eventTriggerRefs:null,innerRef:null,margin:_chartUtils.DEFAULT_CHART_MARGIN,renderTooltip:null,showVoronoi:!1,showXGrid:!1,showYGrid:!1,snapTooltipToDataX:!1,snapTooltipToDataY:!1,theme:{}},getX=function(a){return a&&a.x},getY=function(a){return a&&a.y},XYChart=function(a){function b(a){(0,_classCallCheck3.default)(this,b);var c=(0,_possibleConstructorReturn3.default)(this,(b.__proto__||(0,_getPrototypeOf2.default)(b)).call(this,a));return c.state=a.renderTooltip?{}:b.getStateFromProps(a),c.getDatumCoords=c.getDatumCoords.bind(c),c.handleClick=c.handleClick.bind(c),c.handleMouseLeave=c.handleMouseLeave.bind(c),c.handleMouseMove=c.handleMouseMove.bind(c),c.handleContainerEvent=c.handleContainerEvent.bind(c),c}return(0,_inherits3.default)(b,a),(0,_createClass3.default)(b,[{key:'componentDidMount',value:function componentDidMount(){var a=this.props,b=a.renderTooltip,c=a.eventTriggerRefs;!b&&c&&c({mousemove:this.handleMouseMove,mouseleave:this.handleMouseLeave,click:this.handleClick})}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){var c=this,d=!1;['width','height','children'].some(function(b){return c.props[b]!==a[b]})&&(d=!0),['margin','xScale','yScale'].some(function(b){return!(0,_shallowCompareObjectEntries2.default)(c.props[b],a[b])})&&(d=!0),d&&this.setState(b.getStateFromProps(a))}},{key:'getNumTicks',value:function getNumTicks(a,b){var c=this.props.children,d=(0,_chartUtils.getChildWithName)('XAxis',c),e=(0,_chartUtils.getChildWithName)('YAxis',c);return{numXTicks:(0,_chartUtils.propOrFallback)(d&&d.props,'numTicks',(0,_chartUtils.numTicksForWidth)(a)),numYTicks:(0,_chartUtils.propOrFallback)(e&&e.props,'numTicks',(0,_chartUtils.numTicksForHeight)(b))}}},{key:'getDatumCoords',value:function getDatumCoords(a){var b=this.state,c=b.xScale,d=b.yScale,e=b.margin,f={};return a&&(f.x=c(getX(a))+e.left),a&&(f.y=d(getY(a))+e.top),f}},{key:'handleContainerEvent',value:function handleContainerEvent(a){var b=this.state,c=b.xScale,d=b.yScale,e=this.props.children,f=(0,_findClosestDatums3.default)({children:e,event:a,getX:getX,getY:getY,xScale:c,yScale:d}),g=f.closestDatum,h=f.series;if(g||0<(0,_keys2.default)(h).length){a.persist();var i={event:a,datum:g,series:h};'mousemove'===a.type?this.handleMouseMove(i):'click'===a.type&&this.handleClick(i)}}},{key:'handleMouseMove',value:function handleMouseMove(a){var b=this.props,c=b.snapTooltipToDataX,d=b.snapTooltipToDataY,e=b.onMouseMove,f=a.event&&'focus'===a.event.type;if(e){var g=this.getDatumCoords(a.datum),h=g.x,i=g.y;e((0,_extends3.default)({},a,{coords:(0,_extends3.default)({},(f||c)&&{x:h},(f||d)&&{y:i},a.coords)}))}}},{key:'handleMouseLeave',value:function handleMouseLeave(a){var b=this.props.onMouseLeave;b&&b(a)}},{key:'handleClick',value:function handleClick(a){var b=this.props,c=b.snapTooltipToDataX,d=b.snapTooltipToDataY,e=b.onClick;if(e){var f=this.getDatumCoords(a.datum);e((0,_extends3.default)({},a,{coords:(0,_extends3.default)({x:c?f.x:void 0,y:d?f.y:void 0},a.coords)}))}}},{key:'render',value:function render(){var a=this,c=this.props.renderTooltip;if(c)return _react2.default.createElement(_shared.WithTooltip,{renderTooltip:c},_react2.default.createElement(b,(0,_extends3.default)({},this.props,{renderTooltip:null})));var d=this.props,e=d.ariaLabel,f=d.eventTrigger,g=d.children,h=d.showXGrid,i=d.showYGrid,j=d.theme,k=d.height,l=d.width,m=d.innerRef,n=d.tooltipData,o=d.showVoronoi,p=this.state,q=p.innerWidth,r=p.innerHeight,s=p.margin,t=p.voronoiData,u=p.voronoiX,v=p.voronoiY,w=p.xScale,x=p.yScale,y=this.getNumTicks(q,r),z=y.numXTicks,A=y.numYTicks,B=w.barWidth||w.bandwidth&&w.bandwidth()||0,C=[];return 0<q&&0<r&&_react2.default.createElement('svg',{"aria-label":e,role:'img',width:l,height:k,ref:m},_react2.default.createElement(_group.Group,{left:s.left,top:s.top},(h||i)&&(z||A)&&_react2.default.createElement(_grid.Grid,{xScale:w,yScale:x,width:q,height:r,numTicksRows:i&&A,numTicksColumns:h&&z,stroke:j.gridStyles&&j.gridStyles.stroke,strokeWidth:j.gridStyles&&j.gridStyles.strokeWidth}),_react2.default.Children.map(g,function(b){var c=(0,_chartUtils.componentName)(b);if((0,_chartUtils.isAxis)(c)){var d=c[0].toLowerCase();return _react2.default.cloneElement(b,{innerHeight:r,innerWidth:q,labelOffset:'YAxis'===c?Y_LABEL_OFFSET*s[b.props.orientation]:0,numTicks:'XAxis'===c?z:A,scale:'XAxis'===c?w:x,rangePadding:'XAxis'===c?w.offset:null,axisStyles:(0,_extends3.default)({},j[d+'AxisStyles'],b.props.axisStyles),tickStyles:(0,_extends3.default)({},j[d+'TickStyles'],b.props.tickStyles)})}return(0,_chartUtils.isSeries)(c)?_react2.default.cloneElement(b,{xScale:w,yScale:x,barWidth:B,onClick:b.props.onClick||(b.props.disableMouseEvents?void 0:a.handleClick),onMouseLeave:b.props.onMouseLeave||(b.props.disableMouseEvents?void 0:a.handleMouseLeave),onMouseMove:b.props.onMouseMove||(b.props.disableMouseEvents?void 0:a.handleMouseMove)}):(0,_chartUtils.isCrossHair)(c)?(C.push(b),null):(0,_chartUtils.isReferenceLine)(c)?_react2.default.cloneElement(b,{xScale:w,yScale:x}):b}),f===VORONOI_TRIGGER&&_react2.default.createElement(_Voronoi2.default,{data:t,x:u,y:v,width:q,height:r,onClick:this.handleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,showVoronoi:o}),f===CONTAINER_TRIGGER&&_react2.default.createElement('rect',{x:0,y:0,width:q,height:r,fill:'transparent',fillOpacity:0,onClick:this.handleContainerEvent,onMouseMove:this.handleContainerEvent,onMouseLeave:this.handleMouseLeave}),n&&0<C.length&&C.map(function(a,b){return _react2.default.cloneElement(a,{key:'crosshair-'+b,left:w(getX(n.datum)||0)+(w.bandwidth?w.bandwidth()/2:0),top:x(getY(n.datum)||0),xScale:w,yScale:x})})))}}],[{key:'getStateFromProps',value:function getStateFromProps(a){var b=(0,_getChartDimensions3.default)(a),c=b.margin,d=b.innerWidth,e=b.innerHeight,f=(0,_collectScalesFromProps2.default)(a),g=f.xScale,h=f.yScale,i=(0,_collectVoronoiData2.default)({children:a.children,getX:getX,getY:getY});return{innerHeight:e,innerWidth:d,margin:c,xScale:g,yScale:h,voronoiData:i,voronoiX:function voronoiX(a){return g(getX(a))},voronoiY:function voronoiY(a){return h(getY(a))}}}}]),b}(_react2.default.PureComponent);XYChart.propTypes=propTypes,XYChart.defaultProps=defaultProps,XYChart.displayName='XYChart',exports.default=XYChart;