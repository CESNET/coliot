{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["PureComponent","createElement","PropTypes","StaticMap","MAPBOX_LIMITS","WebMercatorViewport","TransitionManager","EventManager","MapControls","config","deprecateWarn","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","transitionDuration","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onContextMenu","touchAction","string","clickRadius","getCursor","visibilityConstraints","shape","mapControls","events","arrayOf","handleEvent","getDefaultCursor","isDragging","isHovering","CURSOR","GRABBING","POINTER","GRAB","defaultProps","event","preventDefault","childContextTypes","viewport","instanceOf","eventManager","InteractiveMap","supported","constructor","props","state","_mapControls","_eventManager","legacyBlockScroll","getMap","bind","queryRenderedFeatures","_checkVisibilityConstraints","_getFeatures","_onInteractiveStateChange","_getPos","_eventCanvasLoaded","_staticMapLoaded","getChildContext","componentDidMount","on","mousemove","_onMouseMove","click","_onMouseClick","contextmenu","_onContextMenu","setOptions","viewState","onStateChange","_transitionManager","componentWillUpdate","nextProps","nextPropsWithViewState","processViewportChange","_map","geometry","options","capitalize","s","toUpperCase","slice","propName","capitalizedPropName","minPropName","maxPropName","pos","radius","features","size","bbox","setState","offsetCenter","x","y","length","lngLat","unproject","ref","setElement","render","width","height","eventCanvasStyle","position","cursor","key","style","getViewportInTransition","visible","children","displayName"],"mappings":"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","sourcesContent":["import {PureComponent, createElement} from 'react';\nimport PropTypes from 'prop-types';\n\nimport StaticMap from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport TransitionManager from '../utils/transition-manager';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapControls from '../utils/map-controls';\nimport config from '../config';\nimport deprecateWarn from '../utils/deprecate-warn';\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.number,\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.bool,\n  // Drag to pan\n  dragPan: PropTypes.bool,\n  // Drag to rotate\n  dragRotate: PropTypes.bool,\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.bool,\n  // Multitouch rotate\n  touchRotate: PropTypes.bool,\n  // Keyboard\n  keyboard: PropTypes.bool,\n\n /**\n    * Called when the map is hovered over.\n    * @callback\n    * @param {Object} event - The mouse event.\n    * @param {[Number, Number]} event.lngLat - The coordinates of the pointer\n    * @param {Array} event.features - The features under the pointer, using Mapbox's\n    * queryRenderedFeatures API:\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To make a layer interactive, set the `interactive` property in the\n    * layer style to `true`. See Mapbox's style spec\n    * https://www.mapbox.com/mapbox-gl-style-spec/#layer-interactive\n    */\n  onHover: PropTypes.func,\n  /**\n    * Called when the map is clicked.\n    * @callback\n    * @param {Object} event - The mouse event.\n    * @param {[Number, Number]} event.lngLat - The coordinates of the pointer\n    * @param {Array} event.features - The features under the pointer, using Mapbox's\n    * queryRenderedFeatures API:\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To make a layer interactive, set the `interactive` property in the\n    * layer style to `true`. See Mapbox's style spec\n    * https://www.mapbox.com/mapbox-gl-style-spec/#layer-interactive\n    */\n  onClick: PropTypes.func,\n  /**\n    * Called when the context menu is activated.\n    */\n  onContextMenu: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  /** Advanced features */\n  // Contraints for displaying the map. If not met, then the map is hidden.\n  // Experimental! May be changed in minor version updates.\n  visibilityConstraints: PropTypes.shape({\n    minZoom: PropTypes.number,\n    maxZoom: PropTypes.number,\n    minPitch: PropTypes.number,\n    maxPitch: PropTypes.number\n  }),\n  // A map control instance to replace the default map controls\n  // The object must expose one property: `events` as an array of subscribed\n  // event names; and two methods: `setState(state)` and `handle(event)`\n  mapControls: PropTypes.shape({\n    events: PropTypes.arrayOf(PropTypes.string),\n    handleEvent: PropTypes.func\n  })\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) => isDragging ?\n  config.CURSOR.GRABBING :\n  (isHovering ? config.CURSOR.POINTER : config.CURSOR.GRAB);\n\nconst defaultProps = Object.assign({},\n  StaticMap.defaultProps, MAPBOX_LIMITS, TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n\n    touchAction: 'none',\n    clickRadius: 0,\n    getCursor: getDefaultCursor,\n\n    visibilityConstraints: MAPBOX_LIMITS\n  }\n);\n\nconst childContextTypes = {\n  viewport: PropTypes.instanceOf(WebMercatorViewport),\n  isDragging: PropTypes.bool,\n  eventManager: PropTypes.object\n};\n\nexport default class InteractiveMap extends PureComponent {\n\n  static supported() {\n    return StaticMap.supported();\n  }\n\n  constructor(props) {\n    super(props);\n    // Check for deprecated props\n    deprecateWarn(props);\n\n    this.state = {\n      // Whether the cursor is down\n      isDragging: false,\n      // Whether the cursor is over a clickable feature\n      isHovering: false\n    };\n\n    // If props.mapControls is not provided, fallback to default MapControls instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._mapControls = props.mapControls || new MapControls();\n\n    this._eventManager = new EventManager(null, {\n      legacyBlockScroll: false,\n      touchAction: props.touchAction\n    });\n\n    this.getMap = this.getMap.bind(this);\n    this.queryRenderedFeatures = this.queryRenderedFeatures.bind(this);\n    this._checkVisibilityConstraints = this._checkVisibilityConstraints.bind(this);\n    this._getFeatures = this._getFeatures.bind(this);\n    this._onInteractiveStateChange = this._onInteractiveStateChange.bind(this);\n    this._getPos = this._getPos.bind(this);\n    this._eventCanvasLoaded = this._eventCanvasLoaded.bind(this);\n    this._staticMapLoaded = this._staticMapLoaded.bind(this);\n  }\n\n  getChildContext() {\n    return {\n      viewport: new WebMercatorViewport(this.props),\n      isDragging: this.state.isDragging,\n      eventManager: this._eventManager\n    };\n  }\n\n  componentDidMount() {\n    const eventManager = this._eventManager;\n\n    // Register additional event handlers for click and hover\n    eventManager.on({\n      mousemove: this._onMouseMove.bind(this),\n      click: this._onMouseClick.bind(this),\n      contextmenu: this._onContextMenu.bind(this)\n    });\n\n    this._mapControls.setOptions(Object.assign({}, this.props, this.props.viewState, {\n      onStateChange: this._onInteractiveStateChange,\n      eventManager\n    }));\n\n    this._transitionManager = new TransitionManager(this.props);\n  }\n\n  componentWillUpdate(nextProps) {\n    const nextPropsWithViewState = Object.assign({}, nextProps, nextProps.viewState);\n    this._mapControls.setOptions(nextPropsWithViewState);\n    this._transitionManager.processViewportChange(nextPropsWithViewState);\n  }\n\n  getMap() {\n    return this._map ? this._map.getMap() : null;\n  }\n\n  queryRenderedFeatures(geometry, options) {\n    return this._map.queryRenderedFeatures(geometry, options);\n  }\n\n  // Checks a visibilityConstraints object to see if the map should be displayed\n  _checkVisibilityConstraints(props) {\n    const capitalize = s => s[0].toUpperCase() + s.slice(1);\n\n    const {visibilityConstraints} = props;\n    for (const propName in props) {\n      const capitalizedPropName = capitalize(propName);\n      const minPropName = `min${capitalizedPropName}`;\n      const maxPropName = `max${capitalizedPropName}`;\n\n      if (minPropName in visibilityConstraints &&\n        props[propName] < visibilityConstraints[minPropName]) {\n        return false;\n      }\n      if (maxPropName in visibilityConstraints &&\n        props[propName] > visibilityConstraints[maxPropName]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  _getFeatures({pos, radius}) {\n    let features;\n    if (radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      const size = radius;\n      const bbox = [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]];\n      features = this._map.queryRenderedFeatures(bbox);\n    } else {\n      features = this._map.queryRenderedFeatures(pos);\n    }\n    return features;\n  }\n\n  _onInteractiveStateChange({isDragging = false}) {\n    if (isDragging !== this.state.isDragging) {\n      this.setState({isDragging});\n    }\n  }\n\n  // HOVER AND CLICK\n  _getPos(event) {\n    const {offsetCenter: {x, y}} = event;\n    return [x, y];\n  }\n\n  _onMouseMove(event) {\n    if (!this.state.isDragging) {\n      const pos = this._getPos(event);\n      const features = this._getFeatures({pos, radius: this.props.clickRadius});\n\n      const isHovering = features && features.length > 0;\n      if (isHovering !== this.state.isHovering) {\n        this.setState({isHovering});\n      }\n\n      if (this.props.onHover) {\n        const viewport = new WebMercatorViewport(this.props);\n        event.lngLat = viewport.unproject(pos);\n        event.features = features;\n\n        this.props.onHover(event);\n      }\n    }\n  }\n\n  _onMouseClick(event) {\n    if (this.props.onClick) {\n      const pos = this._getPos(event);\n      const viewport = new WebMercatorViewport(this.props);\n      event.lngLat = viewport.unproject(pos);\n      event.features = this._getFeatures({pos, radius: this.props.clickRadius});\n\n      this.props.onClick(event);\n    }\n  }\n\n  _onContextMenu(event) {\n    if (this.props.onContextMenu) {\n      this.props.onContextMenu(event);\n    }\n  }\n\n  _eventCanvasLoaded(ref) {\n    // This will be called with `null` after unmount, releasing event manager resource\n    this._eventManager.setElement(ref);\n  }\n\n  _staticMapLoaded(ref) {\n    this._map = ref;\n  }\n\n  render() {\n    const {width, height, getCursor} = this.props;\n\n    const eventCanvasStyle = {\n      width,\n      height,\n      position: 'relative',\n      cursor: getCursor(this.state)\n    };\n\n    return (\n      createElement('div', {\n        key: 'map-controls',\n        ref: this._eventCanvasLoaded,\n        style: eventCanvasStyle\n      },\n        createElement(StaticMap, Object.assign({}, this.props,\n          this._transitionManager && this._transitionManager.getViewportInTransition(),\n          {\n            visible: this._checkVisibilityConstraints(this.props),\n            ref: this._staticMapLoaded,\n            children: this.props.children\n          }\n        ))\n      )\n    );\n  }\n}\n\nInteractiveMap.displayName = 'InteractiveMap';\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\nInteractiveMap.childContextTypes = childContextTypes;\n"],"file":"interactive-map.js"}